(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[588],{658:(e,t,i)=>{"use strict";i.d(t,{Yn:()=>a,ZH:()=>n,yy:()=>l});let a=e=>e<10?"0".concat(e):e,n=e=>e.charAt(0).toUpperCase()+e.slice(1),l=e=>new Promise(t=>setTimeout(t,e))},2780:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>I});var a=i(37876),n=i(14232),l=i(69241),r=i(45879),o=i(4697),s=i(93725),c=i(2407),d=i(20035);let u=(0,i(89856).A)(),m=(0,d.A)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:i}=e;return[t.root,t[`maxWidth${(0,s.A)(String(i.maxWidth))}`],i.fixed&&t.fixed,i.disableGutters&&t.disableGutters]}}),h=e=>(0,c.A)({props:e,name:"MuiContainer",defaultTheme:u}),v=(e,t)=>{let{classes:i,fixed:a,disableGutters:n,maxWidth:l}=e,c={root:["root",l&&`maxWidth${(0,s.A)(String(l))}`,a&&"fixed",n&&"disableGutters"]};return(0,o.A)(c,e=>(0,r.Ay)(t,e),i)};var p=i(80027),g=i(54773),f=i(52196);let x=function(e={}){let{createStyledComponent:t=m,useThemeProps:i=h,componentName:r="MuiContainer"}=e,o=t(({theme:e,ownerState:t})=>({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",...!t.disableGutters&&{paddingLeft:e.spacing(2),paddingRight:e.spacing(2),[e.breakpoints.up("sm")]:{paddingLeft:e.spacing(3),paddingRight:e.spacing(3)}}}),({theme:e,ownerState:t})=>t.fixed&&Object.keys(e.breakpoints.values).reduce((t,i)=>{let a=e.breakpoints.values[i];return 0!==a&&(t[e.breakpoints.up(i)]={maxWidth:`${a}${e.breakpoints.unit}`}),t},{}),({theme:e,ownerState:t})=>({..."xs"===t.maxWidth&&{[e.breakpoints.up("xs")]:{maxWidth:Math.max(e.breakpoints.values.xs,444)}},...t.maxWidth&&"xs"!==t.maxWidth&&{[e.breakpoints.up(t.maxWidth)]:{maxWidth:`${e.breakpoints.values[t.maxWidth]}${e.breakpoints.unit}`}}}));return n.forwardRef(function(e,t){let n=i(e),{className:s,component:c="div",disableGutters:d=!1,fixed:u=!1,maxWidth:m="lg",classes:h,...p}=n,g={...n,component:c,disableGutters:d,fixed:u,maxWidth:m},f=v(g,r);return(0,a.jsx)(o,{as:c,ownerState:g,className:(0,l.A)(f.root,s),ref:t,...p})})}({createStyledComponent:(0,g.Ay)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:i}=e;return[t.root,t["maxWidth".concat((0,p.A)(String(i.maxWidth)))],i.fixed&&t.fixed,i.disableGutters&&t.disableGutters]}}),useThemeProps:e=>(0,f.b)({props:e,name:"MuiContainer"})});var b=i(11951),k=i(77018),y=i(11494),w=i(24422),j=i(31084),C=i(24705),A=i(97121),W=i(82831),M=i(52547),S=i(85278),_=i(19271),K=i(45175),R=i(34428),E=i(89243),B=i(89099);let N=[_.eK.Splendid,_.eK.Perfect,_.eK.Best,_.eK.Excellent,_.eK.Okay,_.eK.Opening,_.eK.Inaccuracy,_.eK.Mistake,_.eK.Blunder];function I(){let{white:e,black:t}=(0,W.K)(M._X),i=(0,S.md)(M.Mx),l=(0,B.useRouter)(),r=(0,n.useMemo)(()=>i?i.accuracy.white:0,[i]),o=(0,n.useMemo)(()=>i?i.accuracy.black:0,[i]);return(null==i?void 0:i.positions.length)?(0,a.jsxs)(x,{maxWidth:"sm",children:[(0,a.jsx)(A.s,{title:"Game Review"}),(0,a.jsxs)(b.A,{elevation:3,sx:{my:4,p:2,backgroundColor:"#5C3B28",color:"white"},children:[(0,a.jsxs)(y.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,a.jsx)(w.A,{src:"/icons/best.png",sx:{width:56,height:56,mr:2}}),(0,a.jsx)(y.A,{sx:{p:1.5,bgcolor:"rgba(255, 255, 255, 0.9)",borderRadius:"10px",color:"black"},children:(0,a.jsx)(k.A,{variant:"body1",children:"Well done pouncing on that free piece."})})]}),(0,a.jsx)(E.A,{}),(0,a.jsxs)(j.A,{container:!0,alignItems:"center",justifyContent:"space-between",sx:{my:2},children:[(0,a.jsxs)(j.A,{children:[(0,a.jsx)(k.A,{variant:"h6",children:e.name}),(0,a.jsx)(w.A,{src:"/piece/merida/wK.svg",variant:"square",sx:{width:80,height:80,border:"2px solid green"}})]}),(0,a.jsxs)(j.A,{children:[(0,a.jsx)(k.A,{variant:"h6",align:"right",children:t.name}),(0,a.jsx)(w.A,{src:"/piece/merida/bK.svg",variant:"square",sx:{width:80,height:80}})]})]}),(0,a.jsx)(R.A,{title:"Accuracy",whiteValue:r,blackValue:o}),(0,a.jsx)(y.A,{my:2,children:N.map(e=>(0,a.jsx)(K.A,{classification:e},e))}),(0,a.jsx)(y.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,a.jsx)(C.A,{variant:"contained",size:"large",onClick:()=>{l.push("/analysis")},children:"Continue Review"})})]})]}):(0,a.jsxs)(x,{maxWidth:"sm",children:[(0,a.jsx)(A.s,{title:"Game Review"}),(0,a.jsx)(b.A,{elevation:3,sx:{my:4,p:2,backgroundColor:"#5C3B28",color:"white"},children:(0,a.jsx)(k.A,{children:"No game evaluation found. Please analyze a game first."})})]})}},3816:(e,t,i)=>{"use strict";i.d(t,{V:()=>n,e:()=>l});var a=i(658);let n=async(e,t)=>{var i,n;let l=new Date,o=l.getUTCFullYear(),s=l.getUTCMonth()+1,c=(0,a.Yn)(s),d=await fetch("https://api.chess.com/pub/player/".concat(e,"/games/").concat(o,"/").concat(c),{method:"GET",signal:t}),u=await d.json();if(d.status>=400&&"Date cannot be set in the future"!==u.message)throw Error("Error fetching games from Chess.com");let m=null!==(i=null==u?void 0:u.games)&&void 0!==i?i:[];if(m.length<50){let t=1===s?12:s-1,i=(0,a.Yn)(t),l=await fetch("https://api.chess.com/pub/player/".concat(e,"/games/").concat(12===t?o-1:o,"/").concat(i)),r=await l.json();m.push(...null!==(n=null==r?void 0:r.games)&&void 0!==n?n:[])}return m.filter(e=>e.pgn&&e.end_time).sort((e,t)=>t.end_time-e.end_time).slice(0,50).map(r)},l=async e=>{let t=encodeURIComponent(e.trim().toLowerCase()),i=await fetch("https://api.chess.com/pub/player/".concat(t)),a=await i.json(),n=null==a?void 0:a.avatar;return"string"==typeof n?n:null},r=e=>{var t,i,a,n,l,r,s,c,d;let u=null===(t=e.pgn.match(/\[Result "(.*?)"]/))||void 0===t?void 0:t[1],m=null===(i=e.pgn.match(/\d+?\. /g))||void 0===i?void 0:i.length;return{id:e.uuid||(null===(a=e.url)||void 0===a?void 0:a.split("/").pop())||e.id,pgn:e.pgn||"",white:{name:(null===(n=e.white)||void 0===n?void 0:n.username)||"White",rating:(null===(l=e.white)||void 0===l?void 0:l.rating)||0,title:null===(r=e.white)||void 0===r?void 0:r.title},black:{name:(null===(s=e.black)||void 0===s?void 0:s.username)||"Black",rating:(null===(c=e.black)||void 0===c?void 0:c.rating)||0,title:null===(d=e.black)||void 0===d?void 0:d.title},result:u,timeControl:o(e),date:e.end_time?new Date(1e3*e.end_time).toLocaleDateString():new Date().toLocaleDateString(),movesNb:m?2*m:void 0,url:e.url}},o=e=>{let t=e.time_control;if(!t)return;let[i,n]=t.split("+");if(!i)return;let l=Number(i),r=n?"+".concat(n):"";if(l<60)return"".concat(l,"s").concat(r);if(l<3600){let e=Math.floor(l/60),t=l%60;return t?"".concat(e,"m").concat((0,a.Yn)(t),"s").concat(r):"".concat(e,"m").concat(r)}let o=Math.floor(l/3600),s=Math.floor(l%3600/60);return s?"".concat(o,"h").concat((0,a.Yn)(s),"m").concat(r):"".concat(o,"h").concat(r)}},27064:(e,t,i)=>{"use strict";i.d(t,{R:()=>u});var a=i(24307),n=i(99523),l=i(99542),r=i(85278),o=i(89099),s=i(14232);let c=(0,l.eU)([]),d=(0,l.eU)(!1),u=e=>{let[t,i]=(0,s.useState)(null),[l,u]=(0,r.fp)(c),[m,h]=(0,r.fp)(d),[v,p]=(0,s.useState)(void 0);(0,s.useEffect)(()=>{void 0!==e&&h(e)},[e,h]),(0,s.useEffect)(()=>{(async()=>{i(await (0,n.P2)("games",1,{upgrade(e){e.createObjectStore("games",{keyPath:"id",autoIncrement:!0})}}))})()},[]);let g=(0,s.useCallback)(async()=>{t&&m&&u(await t.getAll("games"))},[t,m,u]);(0,s.useEffect)(()=>{g()},[g]);let f=(0,s.useCallback)(async e=>{if(!t)throw Error("Database not initialized");let i=(0,a.mi)(e),n=await t.add("games",i);return g(),n},[t,g]),x=(0,s.useCallback)(async(e,i)=>{if(!t)throw Error("Database not initialized");let a=await t.get("games",e);if(!a)throw Error("Game not found");await t.put("games",{...a,eval:i}),g()},[t,g]),b=(0,s.useCallback)(async e=>{if(t)return t.get("games",e)},[t]),k=(0,s.useCallback)(async e=>{if(!t)throw Error("Database not initialized");await t.delete("games",e),g()},[t,g]),{gameId:y}=(0,o.useRouter)().query;return(0,s.useEffect)(()=>{"string"==typeof y?b(parseInt(y)).then(e=>{p(e)}):p(void 0)},[y,p,b]),{addGame:f,setGameEval:x,getGame:b,deleteGame:k,games:l,isReady:null!==t,gameFromUrl:v}}},34428:(e,t,i)=>{"use strict";i.d(t,{A:()=>r});var a=i(37876),n=i(9227),l=i(77018);function r(e){let{title:t,whiteValue:i,blackValue:r}=e;return(0,a.jsxs)(n.A,{justifyContent:"center",alignItems:"center",flexDirection:"row",columnGap:{xs:"8vw",md:10},children:[(0,a.jsx)(o,{value:i,color:"white"}),(0,a.jsx)(l.A,{align:"center",fontSize:"0.8em",noWrap:!0,children:t}),(0,a.jsx)(o,{value:r,color:"black"})]})}let o=e=>{let{value:t,color:i}=e;return(0,a.jsx)(l.A,{align:"center",sx:{backgroundColor:i,color:"white"===i?"black":"white"},borderRadius:"5px",lineHeight:"1em",fontSize:"0.9em",padding:.8,fontWeight:"500",border:"1px solid #424242",noWrap:!0,children:t})}},38716:(e,t,i)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/review",function(){return i(2780)}])},45175:(e,t,i)=>{"use strict";i.d(t,{A:()=>p});var a=i(37876),n=i(19271),l=i(31084),r=i(77018),o=i(85278),s=i(52547),c=i(14232),d=i(54587),u=i.n(d),m=i(658),h=i(65897),v=i(92094);function p(e){let{classification:t}=e,i=(0,o.md)(s.Mx),d=(0,o.md)(s.Sd),p=(0,o.md)(s._X),{goToMove:g}=(0,h.j)(s.Sd),f=(0,c.useMemo)(()=>i?i.positions.filter((e,i)=>i%2!=0&&e.moveClassification===t).length:0,[i,t]),x=(0,c.useMemo)(()=>i?i.positions.filter((e,i)=>i%2==0&&e.moveClassification===t).length:0,[i,t]),b=e=>{if(!i||e===n.Q1.White&&!f||e===n.Q1.Black&&!x)return;let a=t=>t%2!=0&&e===n.Q1.White||t%2==0&&e===n.Q1.Black,l=d.history().length,r=i.positions.findIndex((e,i)=>a(i)&&e.moveClassification===t&&i>l);if(r>0)g(r,p);else{let e=i.positions.findIndex((e,i)=>a(i)&&e.moveClassification===t);e>0&&e!==l&&g(e,p)}};return(0,a.jsxs)(l.A,{container:!0,justifyContent:"space-evenly",alignItems:"center",wrap:"nowrap",color:v.k_[t],size:12,children:[(0,a.jsx)(l.A,{container:!0,justifyContent:"center",alignItems:"center",width:"3rem",style:{cursor:f?"pointer":"default"},onClick:()=>b(n.Q1.White),fontSize:"0.9rem",children:f}),(0,a.jsxs)(l.A,{container:!0,justifyContent:"start",alignItems:"center",width:"10rem",gap:1,wrap:"nowrap",children:[(0,a.jsx)(u(),{src:"/icons/".concat(t,".png"),alt:"move-icon",width:18,height:18,style:{maxWidth:"3.5vw",maxHeight:"3.5vw"}}),(0,a.jsx)(r.A,{align:"center",fontSize:"0.9rem",children:(0,m.ZH)(t)})]}),(0,a.jsx)(l.A,{container:!0,justifyContent:"center",alignItems:"center",width:"3rem",style:{cursor:x?"pointer":"default"},onClick:()=>b(n.Q1.Black),fontSize:"0.9rem",children:x})]})}},65897:(e,t,i)=>{"use strict";i.d(t,{j:()=>g});var a=i(24307);let n=null,l=null,r=new Map,o={move:"/sounds/move.mp3",capture:"/sounds/capture.mp3",illegalMove:"/sounds/error.mp3"},s=async e=>{l&&clearTimeout(l),l=setTimeout(async()=>{n||(n=new AudioContext),"suspended"===n.state&&await n.resume();let t=r.get(o[e]);if(!t){let i=await fetch(o[e]),a=await n.decodeAudioData(await i.arrayBuffer());t=a,r.set(o[e],a)}let i=n.createBufferSource();i.buffer=t;let a=n.createGain();a.gain.value=.3,i.connect(a),a.connect(n.destination),i.start()},1)},c=()=>s("capture"),d=()=>s("illegalMove"),u=()=>s("move"),m=e=>e?e.captured?c():u():d();var h=i(22277),v=i(85278),p=i(14232);let g=e=>{let[t,i]=(0,v.fp)(e),n=(0,p.useCallback)(e=>{let t=new h.d$;t.loadPgn(e),i(t)},[i]),l=(0,p.useCallback)(e=>{let t=new h.d$(null==e?void 0:e.fen);(null==e?void 0:e.noHeaders)||(0,a.nt)(t,e),i(t)},[i]),r=(0,p.useCallback)(()=>{let e=new h.d$;if(0===t.history().length){var i,a;let n=t.pgn().split("]");if(["1-0","0-1","1/2-1/2","*"].includes(null!==(a=null===(i=n.at(-1))||void 0===i?void 0:i.trim())&&void 0!==a?a:""))return e.loadPgn(n.slice(0,-1).join("]")+"]"),e}return e.loadPgn(t.pgn()),e},[t]),o=(0,p.useCallback)(e=>{let t=e?(0,a.w0)(e):r();t.load(t.getHeaders().FEN||h.OS,{preserveHeaders:!0}),i(t)},[r,i]),s=(0,p.useCallback)(e=>{let t=r();try{let{comment:a,...n}=e,l=t.move(n);return a&&t.setComment(a),i(t),m(l),l}catch(e){return d(),null}},[r,i]),c=(0,p.useCallback)(e=>{let t=r(),a=null;for(let i of e)a=t.move(i);i(t),a&&m(a)},[r,i]);return{setPgn:n,reset:l,playMove:s,undoMove:(0,p.useCallback)(()=>{let e=r(),t=e.undo();t&&m(t),i(e)},[r,i]),goToMove:(0,p.useCallback)((e,t)=>{if(e<0)return;let a=new h.d$;a.loadPgn(t.pgn());let n=t.history().length;if(e>n)return;let l={};for(let t=n;t>e;t--)l=a.undo();i(a),m(l)},[i]),resetToStartingPosition:o,addMoves:c}}},82831:(e,t,i)=>{"use strict";i.d(t,{K:()=>o});var a=i(85278),n=i(27064),l=i(41615),r=i(3816);let o=e=>{var t,i,l,r;let o=(0,a.md)(e),{gameFromUrl:c}=(0,n.R)(),d=o.getHeaders(),u=d.White&&"?"!==d.White?d.White:void 0,m=d.Black&&"?"!==d.Black?d.Black:void 0,h=(null==c?void 0:null===(t=c.white)||void 0===t?void 0:t.name)||u||"White",v=(null==c?void 0:null===(i=c.black)||void 0===i?void 0:i.name)||m||"Black",p=(null==c?void 0:null===(l=c.white)||void 0===l?void 0:l.rating)||Number(d.WhiteElo)||void 0,g=(null==c?void 0:null===(r=c.black)||void 0===r?void 0:r.rating)||Number(d.BlackElo)||void 0,f=((null==c?void 0:c.site)||d.Site||"unknown").toLowerCase().includes("chess.com"),x=s(h,f&&!!h&&"White"!==h),b=s(v,f&&!!v&&"Black"!==v);return{white:{name:h,rating:p,avatarUrl:null!=x?x:void 0},black:{name:v,rating:g,avatarUrl:null!=b?b:void 0}}},s=(e,t)=>{let{data:i}=(0,l.I)({queryKey:["CCAvatar",e],enabled:t,queryFn:()=>(0,r.e)(e),staleTime:36e5,gcTime:864e5});return i}},89243:(e,t,i)=>{"use strict";i.d(t,{A:()=>w});var a=i(37876),n=i(14232),l=i(31084),r=i(11494),o=i(85278),s=i(80252),c=i(57377),d=i(22333),u=i(24354),m=i(1874),h=i(56321),v=i(75271),p=i(52547),g=i(24307);function f(e){let{active:t,payload:i}=e;if(!t||!(null==i?void 0:i.length))return null;let n=i[0].payload;return(0,a.jsx)("div",{style:{backgroundColor:"#f0f0f0",padding:5,color:"black",opacity:.9,border:"1px solid black",borderRadius:3},children:(0,g.l3)(n)})}var x=i(92094);function b(e){let{cx:t,cy:i,r:n,payload:l}=e,r=(null==l?void 0:l.moveClassification)?x.k_[l.moveClassification]:"grey";return(0,a.jsx)("circle",{cx:t,cy:i,r:n,stroke:r,strokeWidth:5,fill:r,fillOpacity:1})}var k=i(19271),y=i(65897);function w(e){var t;let i=(0,o.md)(p.Mx),g=(0,o.md)(p.eU),{goToMove:w}=(0,y.j)(p.Sd),C=(0,o.md)(p._X),A=(0,n.useMemo)(()=>{var e;return null!==(e=null==i?void 0:i.positions.map(j))&&void 0!==e?e:[]},[i]),W=(0,n.useMemo)(()=>{let e=A.filter(e=>e.moveClassification===k.eK.Best),t=Math.ceil(.15*e.length),i=e.map(e=>e.moveNb);for(let e=i.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[i[e],i[t]]=[i[t],i[e]]}return new Set(i.slice(0,t))},[A]),M=(null===(t=g.eval)||void 0===t?void 0:t.moveClassification)?x.k_[g.eval.moveClassification]:"grey",S=(0,n.useCallback)(e=>{let t=e.payload,i=null==t?void 0:t.moveClassification;return i&&([k.eK.Splendid,k.eK.Perfect,k.eK.Blunder,k.eK.Mistake].includes(i)||i===k.eK.Best&&W.has(t.moveNb))?(0,n.createElement)(b,{...e,key:e.key,payload:t}):(0,a.jsx)("svg",{},e.key)},[W]);return i?(0,a.jsx)(l.A,{container:!0,justifyContent:"center",alignItems:"center",minHeight:"min(10rem, 8vh)",height:{xs:"8rem",lg:"none"},maxHeight:"10rem",...e,sx:e.hidden?{display:"none"}:e.sx,size:12,children:(0,a.jsx)(r.A,{height:"100%",width:{xs:"100%",lg:"90%"},sx:{backgroundColor:"#2e2e2e",borderRadius:"15px",overflow:"hidden"},children:(0,a.jsx)(s.u,{width:"100%",height:"100%",children:(0,a.jsxs)(c.Q,{width:500,height:400,data:A,margin:{top:0,left:0,right:0,bottom:0},onClick:e=>{var t,i;let a=null==e?void 0:null===(i=e.activePayload)||void 0===i?void 0:null===(t=i[0])||void 0===t?void 0:t.payload;a&&w(a.moveNb,C)},style:{cursor:"pointer"},children:[(0,a.jsx)(d.W,{dataKey:"moveNb",hide:!0,stroke:"red"}),(0,a.jsx)(u.h,{domain:[0,20],hide:!0}),(0,a.jsx)(m.m,{content:(0,a.jsx)(f,{}),isAnimationActive:!1,cursor:{stroke:"grey",strokeWidth:2,strokeOpacity:.3}}),(0,a.jsx)(h.G,{type:"monotone",dataKey:"value",stroke:"none",fill:"#ffffff",fillOpacity:1,dot:S,activeDot:(0,a.jsx)(b,{}),isAnimationActive:!1}),(0,a.jsx)(v.e,{y:10,stroke:"grey",strokeWidth:2,strokeOpacity:.4}),(0,a.jsx)(v.e,{x:g.currentMoveIdx,stroke:M,strokeWidth:4,strokeOpacity:.6})]})})})}):null}let j=(e,t)=>{let i=e.lines[0],a={moveNb:t,value:10,cp:i.cp,mate:i.mate,moveClassification:e.moveClassification};return i.mate?{...a,value:20*(i.mate>0)}:i.cp?{...a,value:Math.max(Math.min(i.cp/100,10),-10)+10}:a}},97121:(e,t,i)=>{"use strict";i.d(t,{s:()=>r});var a=i(37876),n=i(77328),l=i.n(n);let r=e=>{let{title:t}=e;return(0,a.jsxs)(l(),{children:[(0,a.jsx)("title",{children:t}),(0,a.jsx)("meta",{property:"og:title",content:t})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[969,927,636,593,792],()=>t(38716)),_N_E=e.O()}]);