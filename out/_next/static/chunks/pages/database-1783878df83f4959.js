(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[271],{658:(e,t,a)=>{"use strict";a.d(t,{Yn:()=>n,ZH:()=>i,yy:()=>l});let n=e=>e<10?"0".concat(e):e,i=e=>e.charAt(0).toUpperCase()+e.slice(1),l=e=>new Promise(t=>setTimeout(t,e))},3816:(e,t,a)=>{"use strict";a.d(t,{V:()=>i,e:()=>l});var n=a(658);let i=async(e,t)=>{var a,i;let l=new Date,r=l.getUTCFullYear(),c=l.getUTCMonth()+1,s=(0,n.Yn)(c),d=await fetch("https://api.chess.com/pub/player/".concat(e,"/games/").concat(r,"/").concat(s),{method:"GET",signal:t}),u=await d.json();if(d.status>=400&&"Date cannot be set in the future"!==u.message)throw Error("Error fetching games from Chess.com");let h=null!==(a=null==u?void 0:u.games)&&void 0!==a?a:[];if(h.length<50){let t=1===c?12:c-1,a=(0,n.Yn)(t),l=await fetch("https://api.chess.com/pub/player/".concat(e,"/games/").concat(12===t?r-1:r,"/").concat(a)),o=await l.json();h.push(...null!==(i=null==o?void 0:o.games)&&void 0!==i?i:[])}return h.filter(e=>e.pgn&&e.end_time).sort((e,t)=>t.end_time-e.end_time).slice(0,50).map(o)},l=async e=>{let t=encodeURIComponent(e.trim().toLowerCase()),a=await fetch("https://api.chess.com/pub/player/".concat(t)),n=await a.json(),i=null==n?void 0:n.avatar;return"string"==typeof i?i:null},o=e=>{var t,a,n,i,l,o,c,s,d;let u=null===(t=e.pgn.match(/\[Result "(.*?)"]/))||void 0===t?void 0:t[1],h=null===(a=e.pgn.match(/\d+?\. /g))||void 0===a?void 0:a.length;return{id:e.uuid||(null===(n=e.url)||void 0===n?void 0:n.split("/").pop())||e.id,pgn:e.pgn||"",white:{name:(null===(i=e.white)||void 0===i?void 0:i.username)||"White",rating:(null===(l=e.white)||void 0===l?void 0:l.rating)||0,title:null===(o=e.white)||void 0===o?void 0:o.title},black:{name:(null===(c=e.black)||void 0===c?void 0:c.username)||"Black",rating:(null===(s=e.black)||void 0===s?void 0:s.rating)||0,title:null===(d=e.black)||void 0===d?void 0:d.title},result:u,timeControl:r(e),date:e.end_time?new Date(1e3*e.end_time).toLocaleDateString():new Date().toLocaleDateString(),movesNb:h?2*h:void 0,url:e.url}},r=e=>{let t=e.time_control;if(!t)return;let[a,i]=t.split("+");if(!a)return;let l=Number(a),o=i?"+".concat(i):"";if(l<60)return"".concat(l,"s").concat(o);if(l<3600){let e=Math.floor(l/60),t=l%60;return t?"".concat(e,"m").concat((0,n.Yn)(t),"s").concat(o):"".concat(e,"m").concat(o)}let r=Math.floor(l/3600),c=Math.floor(l%3600/60);return c?"".concat(r,"h").concat((0,n.Yn)(c),"m").concat(o):"".concat(r,"h").concat(o)}},27064:(e,t,a)=>{"use strict";a.d(t,{R:()=>u});var n=a(24307),i=a(99523),l=a(99542),o=a(85278),r=a(89099),c=a(14232);let s=(0,l.eU)([]),d=(0,l.eU)(!1),u=e=>{let[t,a]=(0,c.useState)(null),[l,u]=(0,o.fp)(s),[h,m]=(0,o.fp)(d),[g,p]=(0,c.useState)(void 0);(0,c.useEffect)(()=>{void 0!==e&&m(e)},[e,m]),(0,c.useEffect)(()=>{(async()=>{a(await (0,i.P2)("games",1,{upgrade(e){e.createObjectStore("games",{keyPath:"id",autoIncrement:!0})}}))})()},[]);let v=(0,c.useCallback)(async()=>{t&&h&&u(await t.getAll("games"))},[t,h,u]);(0,c.useEffect)(()=>{v()},[v]);let f=(0,c.useCallback)(async e=>{if(!t)throw Error("Database not initialized");let a=(0,n.mi)(e),i=await t.add("games",a);return v(),i},[t,v]),w=(0,c.useCallback)(async(e,a)=>{if(!t)throw Error("Database not initialized");let n=await t.get("games",e);if(!n)throw Error("Game not found");await t.put("games",{...n,eval:a}),v()},[t,v]),b=(0,c.useCallback)(async e=>{if(t)return t.get("games",e)},[t]),y=(0,c.useCallback)(async e=>{if(!t)throw Error("Database not initialized");await t.delete("games",e),v()},[t,v]),{gameId:C}=(0,r.useRouter)().query;return(0,c.useEffect)(()=>{"string"==typeof C?b(parseInt(C)).then(e=>{p(e)}):p(void 0)},[C,p,b]),{addGame:f,setGameEval:w,getGame:b,deleteGame:y,games:l,isReady:null!==t,gameFromUrl:g}}},36329:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>w});var n=a(37876),i=a(31084),l=a(77018),o=a(98594),r=a(22999),c=a(82277),s=a(38679),d=a(14232),u=a(98291),h=a(90932),m=a(88546),g=a(27064),p=a(89099),v=a(97121);let f={...r._,noRowsLabel:"No games found"};function w(){let{games:e,deleteGame:t}=(0,g.R)(!0),a=(0,p.useRouter)();console.log(e);let r=(0,d.useCallback)(e=>async()=>{if("number"!=typeof e)throw Error("Unable to remove game");await t(e)},[t]),w=(0,d.useCallback)(t=>async()=>{var a,n;if("number"!=typeof t)throw Error("Unable to copy game");await (null===(n=navigator.clipboard)||void 0===n?void 0:null===(a=n.writeText)||void 0===a?void 0:a.call(n,e[t-1].pgn))},[e]),b=(0,d.useMemo)(()=>[{field:"event",headerName:"Event",width:150},{field:"site",headerName:"Site",width:150},{field:"date",headerName:"Date",width:150},{field:"round",headerName:"Round",headerAlign:"center",align:"center",width:150},{field:"whiteLabel",headerName:"White",width:200,headerAlign:"center",align:"center",valueGetter:(e,t)=>{var a,n;return"".concat(null!==(a=t.white.name)&&void 0!==a?a:"Unknown"," (").concat(null!==(n=t.white.rating)&&void 0!==n?n:"?",")")}},{field:"result",headerName:"Result",headerAlign:"center",align:"center",width:100},{field:"blackLabel",headerName:"Black",width:200,headerAlign:"center",align:"center",valueGetter:(e,t)=>{var a,n;return"".concat(null!==(a=t.black.name)&&void 0!==a?a:"Unknown"," (").concat(null!==(n=t.black.rating)&&void 0!==n?n:"?",")")}},{field:"eval",headerName:"Evaluation",type:"boolean",headerAlign:"center",align:"center",width:100,valueGetter:(e,t)=>!!t.eval},{field:"openEvaluation",type:"actions",headerName:"Analyze",width:100,cellClassName:"actions",getActions:e=>{let{id:t}=e;return[(0,n.jsx)(c.Z,{icon:(0,n.jsx)(o.In,{icon:"streamline:magnifying-glass-solid",width:"20px"}),label:"Open Evaluation",onClick:()=>a.push({pathname:"/",query:{gameId:t}}),color:"inherit"},"".concat(t,"-open-eval-button"))]}},{field:"delete",type:"actions",headerName:"Delete",width:100,cellClassName:"actions",getActions:e=>{let{id:t}=e;return[(0,n.jsx)(c.Z,{icon:(0,n.jsx)(o.In,{icon:"mdi:delete-outline",color:u.A[400],width:"20px"}),label:"Delete",onClick:r(t),color:"inherit"},"".concat(t,"-delete-button"))]}},{field:"copy pgn",type:"actions",headerName:"Copy pgn",width:100,cellClassName:"actions",getActions:e=>{let{id:t}=e;return[(0,n.jsx)(c.Z,{icon:(0,n.jsx)(o.In,{icon:"ri:clipboard-line",color:h.A[400],width:"20px"}),label:"Copy pgn",onClick:w(t),color:"inherit"},"".concat(t,"-copy-button"))]}}],[r,w,a]);return(0,n.jsxs)(i.A,{container:!0,justifyContent:"center",alignItems:"center",gap:4,marginTop:6,children:[(0,n.jsx)(v.s,{title:"Chesskit Game Database"}),(0,n.jsx)(i.A,{container:!0,justifyContent:"center",alignItems:"center",size:12,children:(0,n.jsx)(m.A,{})}),(0,n.jsx)(i.A,{container:!0,justifyContent:"center",alignItems:"center",size:12,children:(0,n.jsxs)(l.A,{variant:"subtitle2",children:["You have ",e.length," game",1!==e.length&&"s"," in your database"]})}),(0,n.jsx)(i.A,{maxWidth:"100%",minWidth:"50px",children:(0,n.jsx)(s.z,{"aria-label":"Games list",rows:e,columns:b,disableColumnMenu:!0,hideFooter:!0,localeText:f,initialState:{sorting:{sortModel:[{field:"date",sort:"desc"}]}}})})]})}},94186:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/database",function(){return a(36329)}])},97121:(e,t,a)=>{"use strict";a.d(t,{s:()=>o});var n=a(37876),i=a(77328),l=a.n(i);let o=e=>{let{title:t}=e;return(0,n.jsxs)(l(),{children:[(0,n.jsx)("title",{children:t}),(0,n.jsx)("meta",{property:"og:title",content:t})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[969,696,986,539,546,636,593,792],()=>t(94186)),_N_E=e.O()}]);