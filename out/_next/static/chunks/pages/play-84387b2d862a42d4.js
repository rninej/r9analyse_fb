(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[174],{658:(e,t,n)=>{"use strict";n.d(t,{Yn:()=>a,ZH:()=>i,yy:()=>l});let a=e=>e<10?"0".concat(e):e,i=e=>e.charAt(0).toUpperCase()+e.slice(1),l=e=>new Promise(t=>setTimeout(t,e))},3816:(e,t,n)=>{"use strict";n.d(t,{V:()=>i,e:()=>l});var a=n(658);let i=async(e,t)=>{var n,i;let l=new Date,o=l.getUTCFullYear(),s=l.getUTCMonth()+1,c=(0,a.Yn)(s),u=await fetch("https://api.chess.com/pub/player/".concat(e,"/games/").concat(o,"/").concat(c),{method:"GET",signal:t}),d=await u.json();if(u.status>=400&&"Date cannot be set in the future"!==d.message)throw Error("Error fetching games from Chess.com");let m=null!==(n=null==d?void 0:d.games)&&void 0!==n?n:[];if(m.length<50){let t=1===s?12:s-1,n=(0,a.Yn)(t),l=await fetch("https://api.chess.com/pub/player/".concat(e,"/games/").concat(12===t?o-1:o,"/").concat(n)),r=await l.json();m.push(...null!==(i=null==r?void 0:r.games)&&void 0!==i?i:[])}return m.filter(e=>e.pgn&&e.end_time).sort((e,t)=>t.end_time-e.end_time).slice(0,50).map(r)},l=async e=>{let t=encodeURIComponent(e.trim().toLowerCase()),n=await fetch("https://api.chess.com/pub/player/".concat(t)),a=await n.json(),i=null==a?void 0:a.avatar;return"string"==typeof i?i:null},r=e=>{var t,n,a,i,l,r,s,c,u;let d=null===(t=e.pgn.match(/\[Result "(.*?)"]/))||void 0===t?void 0:t[1],m=null===(n=e.pgn.match(/\d+?\. /g))||void 0===n?void 0:n.length;return{id:e.uuid||(null===(a=e.url)||void 0===a?void 0:a.split("/").pop())||e.id,pgn:e.pgn||"",white:{name:(null===(i=e.white)||void 0===i?void 0:i.username)||"White",rating:(null===(l=e.white)||void 0===l?void 0:l.rating)||0,title:null===(r=e.white)||void 0===r?void 0:r.title},black:{name:(null===(s=e.black)||void 0===s?void 0:s.username)||"Black",rating:(null===(c=e.black)||void 0===c?void 0:c.rating)||0,title:null===(u=e.black)||void 0===u?void 0:u.title},result:d,timeControl:o(e),date:e.end_time?new Date(1e3*e.end_time).toLocaleDateString():new Date().toLocaleDateString(),movesNb:m?2*m:void 0,url:e.url}},o=e=>{let t=e.time_control;if(!t)return;let[n,i]=t.split("+");if(!n)return;let l=Number(n),r=i?"+".concat(i):"";if(l<60)return"".concat(l,"s").concat(r);if(l<3600){let e=Math.floor(l/60),t=l%60;return t?"".concat(e,"m").concat((0,a.Yn)(t),"s").concat(r):"".concat(e,"m").concat(r)}let o=Math.floor(l/3600),s=Math.floor(l%3600/60);return s?"".concat(o,"h").concat((0,a.Yn)(s),"m").concat(r):"".concat(o,"h").concat(r)}},23876:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/play",function(){return n(50266)}])},27064:(e,t,n)=>{"use strict";n.d(t,{R:()=>d});var a=n(24307),i=n(99523),l=n(99542),r=n(85278),o=n(89099),s=n(14232);let c=(0,l.eU)([]),u=(0,l.eU)(!1),d=e=>{let[t,n]=(0,s.useState)(null),[l,d]=(0,r.fp)(c),[m,h]=(0,r.fp)(u),[g,v]=(0,s.useState)(void 0);(0,s.useEffect)(()=>{void 0!==e&&h(e)},[e,h]),(0,s.useEffect)(()=>{(async()=>{n(await (0,i.P2)("games",1,{upgrade(e){e.createObjectStore("games",{keyPath:"id",autoIncrement:!0})}}))})()},[]);let f=(0,s.useCallback)(async()=>{t&&m&&d(await t.getAll("games"))},[t,m,d]);(0,s.useEffect)(()=>{f()},[f]);let p=(0,s.useCallback)(async e=>{if(!t)throw Error("Database not initialized");let n=(0,a.mi)(e),i=await t.add("games",n);return f(),i},[t,f]),w=(0,s.useCallback)(async(e,n)=>{if(!t)throw Error("Database not initialized");let a=await t.get("games",e);if(!a)throw Error("Game not found");await t.put("games",{...a,eval:n}),f()},[t,f]),y=(0,s.useCallback)(async e=>{if(t)return t.get("games",e)},[t]),j=(0,s.useCallback)(async e=>{if(!t)throw Error("Database not initialized");await t.delete("games",e),f()},[t,f]),{gameId:b}=(0,o.useRouter)().query;return(0,s.useEffect)(()=>{"string"==typeof b?y(parseInt(b)).then(e=>{v(e)}):v(void 0)},[b,v,y]),{addGame:p,setGameEval:w,getGame:y,deleteGame:j,games:l,isReady:null!==t,gameFromUrl:g}}},50266:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>et});var a=n(37876),i=n(97121),l=n(85278),r=n(92094),o=n(19271),s=n(22277),c=n(99542);let u=(0,c.eU)(new s.d$),d=(0,c.eU)({}),m=(0,c.eU)(o.Q1.White),h=(0,c.eU)(r.T3),g=(0,c.eU)(1320),v=(0,c.eU)(!1);var f=n(65897),p=n(14232),w=n(69846),y=n(32253),j=n(24307),b=n(19410);let x=(e,t)=>{let n=(0,l.md)(e),[a,i]=(0,l.fp)(t);return(0,p.useEffect)(()=>{i({lastMove:n.history({verbose:!0}).at(-1)})},[n]),a};var k=n(82831),C=n(658);function A(){let e=(0,w.l)(),t=(0,l.md)(h),n=(0,y.K)(t),i=(0,l.md)(u),{white:r,black:o}=(0,k.K)(u),s=(0,l.md)(m),{playMove:c}=(0,f.j)(u),A=(0,l.md)(g),E=(0,l.md)(v),W=i.fen(),S=i.isGameOver();(0,p.useEffect)(()=>((async()=>{if(!(null==n?void 0:n.getIsReady())||i.turn()===s||S||!E)return;let e=(0,C.yy)(1e3),t=await n.getEngineNextMove(W,A);await e,t&&c((0,j.vc)(t))})(),()=>{null==n||n.stopAllCurrentJobs()}),[W,E]);let B=(0,p.useMemo)(()=>{var t;let n=e.width,a=e.height;return(null===(t=window)||void 0===t?void 0:t.innerWidth)<900?Math.min(n,a-150):Math.min(n-300,.83*a)},[e]);return x(u,d),(0,a.jsx)(b.h,{id:"PlayBoard",canPlay:!!E&&s,gameAtom:u,boardSize:B,whitePlayer:r,blackPlayer:o,boardOrientation:s,currentPositionAtom:d})}var E=n(31084),W=n(77018),S=n(7957),B=n(24705);function _(){let e=(0,l.md)(u),{goToMove:t,undoMove:n}=(0,f.j)(u),i=(0,l.md)(m);return(0,a.jsx)(B.A,{variant:"outlined",onClick:()=>{let a=e.history(),l=e.turn();if("w"===l&&i===o.Q1.White||"b"===l&&i===o.Q1.Black){if(a.length<2)return;t(a.length-2,e)}else{if(!a.length)return;n()}},children:"Undo your last move"})}function z(){let e=(0,l.md)(u),[t,n]=(0,l.fp)(v);return((0,p.useEffect)(()=>{e.isGameOver()&&n(!1)},[e,n]),t)?(0,a.jsxs)(E.A,{container:!0,justifyContent:"center",alignItems:"center",gap:2,size:12,children:[(0,a.jsxs)(E.A,{container:!0,justifyContent:"center",alignItems:"center",gap:2,size:12,children:[(0,a.jsx)(W.A,{children:"Game in progress"}),(0,a.jsx)(S.A,{size:20,color:"info"})]}),(0,a.jsx)(E.A,{container:!0,justifyContent:"center",alignItems:"center",size:12,children:(0,a.jsx)(_,{})}),(0,a.jsx)(E.A,{container:!0,justifyContent:"center",alignItems:"center",size:12,children:(0,a.jsx)(B.A,{variant:"outlined",onClick:()=>{n(!1)},children:"Resign"})})]}):null}var T=n(27064),I=n(89099);function M(){let e=(0,l.md)(u),t=(0,l.md)(m),n=(0,l.md)(v),{addGame:i}=(0,T.R)(),r=(0,I.useRouter)();if(n||!e.history().length)return null;let s=async()=>{let n=(0,j.nt)(e,{resigned:e.isGameOver()?void 0:t}),a=await i(n);r.push({pathname:"/",query:{gameId:a}})};return(0,a.jsxs)(E.A,{container:!0,justifyContent:"center",alignItems:"center",gap:2,size:12,children:[(0,a.jsx)(E.A,{container:!0,justifyContent:"center",size:12,children:(0,a.jsx)(W.A,{children:(()=>{if(e.isCheckmate()){let n=("w"===e.turn()?o.Q1.Black:o.Q1.White)===t?"You":"Stockfish";return"".concat(n," won by checkmate !")}return e.isInsufficientMaterial()?"Draw by insufficient material":e.isStalemate()?"Draw by stalemate":e.isThreefoldRepetition()?"Draw by threefold repetition":e.isDraw()?"Draw by fifty-move rule":"You resigned"})()})}),(0,a.jsx)(B.A,{variant:"outlined",onClick:s,children:"Open game analysis"})]})}var P=n(18259),Q=n(84147),U=n(47866),D=n(3034),N=n(88713),R=n(90405),Y=n(35779),O=n(83290),G=n(6003),H=n(36085),q=n(35656),F=n(81104),$=n(77935),L=n(78523),K=n(37242),X=n(9320),V=n(47713),J=n(43699);function Z(e){let{open:t,onClose:n}=e,[i,s]=(0,K.v)("engine-elo",g),[c,d]=(0,K.v)("engine-play-name",h),[w,y]=(0,l.fp)(m),b=(0,l.Xr)(v),{reset:x}=(0,f.j)(u),[k,C]=(0,p.useState)(""),[A,S]=(0,p.useState)("");(0,p.useEffect)(()=>{(0,V.N9)(c)||(J.m.isSupported()?d(o.Qz.Stockfish16_1Lite):d(o.Qz.Stockfish11))},[d,c]);let _=()=>{n(),C(""),S("")};return(0,a.jsxs)(Q.A,{open:t,onClose:_,maxWidth:"md",fullWidth:!0,children:[(0,a.jsx)(U.A,{marginY:1,variant:"h5",children:"Set game parameters"}),(0,a.jsxs)(D.A,{sx:{paddingBottom:0},children:[(0,a.jsxs)(W.A,{children:[r.H[r.T3].small," is the default engine if your device support its requirements. It offers the best balance between speed and strength. ",r.H[r.RS].small," is the strongest engine available, note that it requires a one time download of 75MB."]}),(0,a.jsxs)(E.A,{marginTop:4,container:!0,justifyContent:"center",alignItems:"center",rowGap:3,size:12,children:[(0,a.jsx)(E.A,{container:!0,justifyContent:"center",size:12,children:(0,a.jsxs)(N.A,{variant:"outlined",children:[(0,a.jsx)(R.A,{id:"dialog-select-label",children:"Bot's engine"}),(0,a.jsx)(Y.A,{labelId:"dialog-select-label",id:"dialog-select",displayEmpty:!0,input:(0,a.jsx)(O.A,{label:"Engine"}),value:c,onChange:e=>d(e.target.value),sx:{width:280,maxWidth:"100%"},children:Object.values(o.Qz).map(e=>(0,a.jsx)(G.A,{value:e,disabled:!(0,V.N9)(e),children:r.H[e].full},e))})]})}),(0,a.jsx)(P.A,{label:"Bot Elo rating",value:i,setValue:s,min:1320,max:3190,step:10,marksFilter:374}),(0,a.jsx)(H.A,{children:(0,a.jsx)(q.A,{control:(0,a.jsx)(F.A,{color:"default",checked:w===o.Q1.White,onChange:e=>{y(e.target.checked?o.Q1.White:o.Q1.Black)}}),label:w===o.Q1.White?"You play as White":"You play as Black"})}),(0,a.jsx)(N.A,{fullWidth:!0,children:(0,a.jsx)($.A,{label:"Optional starting position (FEN or PGN)",variant:"outlined",multiline:!0,value:k,onChange:e=>C(e.target.value)})}),A&&(0,a.jsx)(N.A,{fullWidth:!0,children:(0,a.jsx)(W.A,{color:"salmon",textAlign:"center",marginTop:1,children:A})})]})]}),(0,a.jsxs)(L.A,{sx:{m:2},children:[(0,a.jsx)(B.A,{variant:"outlined",sx:{marginRight:2},onClick:_,children:"Cancel"}),(0,a.jsx)(B.A,{variant:"contained",onClick:()=>{S("");try{let e=k.trim(),t=e.startsWith("[")?(0,j.w0)(e).fen():e||void 0;x({white:{name:w===o.Q1.White?"You":r.H[c].small,rating:w===o.Q1.White?void 0:i},black:{name:w===o.Q1.Black?"You":r.H[c].small,rating:w===o.Q1.Black?void 0:i},fen:t})}catch(e){console.error(e),S(e instanceof Error?"".concat(e.message," !"):"Unknown error while parsing input !");return}b(!0),_(),(0,X.$)("play_game",{engine:c,engineElo:i,playerColor:w})},children:"Start game"})]})]})}function ee(){let[e,t]=(0,p.useState)(!1),n=(0,l.md)(u);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(B.A,{variant:"contained",onClick:()=>t(!0),children:n.history().length?"Start new game":"Start game"}),(0,a.jsx)(Z,{open:e,onClose:()=>t(!1)})]})}function et(){let e=(0,l.md)(v);return(0,a.jsxs)(E.A,{container:!0,gap:4,justifyContent:"space-evenly",alignItems:"start",children:[(0,a.jsx)(i.s,{title:"Chesskit Play vs Stockfish"}),(0,a.jsx)(A,{}),(0,a.jsxs)(E.A,{container:!0,marginTop:{xs:0,md:"2.5em"},justifyContent:"center",alignItems:"center",borderRadius:2,border:1,borderColor:"secondary.main",size:{xs:12,md:"grow"},sx:{backgroundColor:"secondary.main",borderColor:"primary.main",borderWidth:2,boxShadow:"0 2px 10px rgba(0, 0, 0, 0.5)"},padding:3,rowGap:3,style:{maxWidth:"400px"},children:[(0,a.jsx)(z,{}),!e&&(0,a.jsx)(ee,{}),(0,a.jsx)(M,{})]})]})}},65897:(e,t,n)=>{"use strict";n.d(t,{j:()=>f});var a=n(24307);let i=null,l=null,r=new Map,o={move:"/sounds/move.mp3",capture:"/sounds/capture.mp3",illegalMove:"/sounds/error.mp3"},s=async e=>{l&&clearTimeout(l),l=setTimeout(async()=>{i||(i=new AudioContext),"suspended"===i.state&&await i.resume();let t=r.get(o[e]);if(!t){let n=await fetch(o[e]),a=await i.decodeAudioData(await n.arrayBuffer());t=a,r.set(o[e],a)}let n=i.createBufferSource();n.buffer=t;let a=i.createGain();a.gain.value=.3,n.connect(a),a.connect(i.destination),n.start()},1)},c=()=>s("capture"),u=()=>s("illegalMove"),d=()=>s("move"),m=e=>e?e.captured?c():d():u();var h=n(22277),g=n(85278),v=n(14232);let f=e=>{let[t,n]=(0,g.fp)(e),i=(0,v.useCallback)(e=>{let t=new h.d$;t.loadPgn(e),n(t)},[n]),l=(0,v.useCallback)(e=>{let t=new h.d$(null==e?void 0:e.fen);(null==e?void 0:e.noHeaders)||(0,a.nt)(t,e),n(t)},[n]),r=(0,v.useCallback)(()=>{let e=new h.d$;if(0===t.history().length){var n,a;let i=t.pgn().split("]");if(["1-0","0-1","1/2-1/2","*"].includes(null!==(a=null===(n=i.at(-1))||void 0===n?void 0:n.trim())&&void 0!==a?a:""))return e.loadPgn(i.slice(0,-1).join("]")+"]"),e}return e.loadPgn(t.pgn()),e},[t]),o=(0,v.useCallback)(e=>{let t=e?(0,a.w0)(e):r();t.load(t.getHeaders().FEN||h.OS,{preserveHeaders:!0}),n(t)},[r,n]),s=(0,v.useCallback)(e=>{let t=r();try{let{comment:a,...i}=e,l=t.move(i);return a&&t.setComment(a),n(t),m(l),l}catch(e){return u(),null}},[r,n]),c=(0,v.useCallback)(e=>{let t=r(),a=null;for(let n of e)a=t.move(n);n(t),a&&m(a)},[r,n]);return{setPgn:i,reset:l,playMove:s,undoMove:(0,v.useCallback)(()=>{let e=r(),t=e.undo();t&&m(t),n(e)},[r,n]),goToMove:(0,v.useCallback)((e,t)=>{if(e<0)return;let a=new h.d$;a.loadPgn(t.pgn());let i=t.history().length;if(e>i)return;let l={};for(let t=i;t>e;t--)l=a.undo();n(a),m(l)},[n]),resetToStartingPosition:o,addMoves:c}}},82831:(e,t,n)=>{"use strict";n.d(t,{K:()=>o});var a=n(85278),i=n(27064),l=n(41615),r=n(3816);let o=e=>{var t,n,l,r;let o=(0,a.md)(e),{gameFromUrl:c}=(0,i.R)(),u=o.getHeaders(),d=u.White&&"?"!==u.White?u.White:void 0,m=u.Black&&"?"!==u.Black?u.Black:void 0,h=(null==c?void 0:null===(t=c.white)||void 0===t?void 0:t.name)||d||"White",g=(null==c?void 0:null===(n=c.black)||void 0===n?void 0:n.name)||m||"Black",v=(null==c?void 0:null===(l=c.white)||void 0===l?void 0:l.rating)||Number(u.WhiteElo)||void 0,f=(null==c?void 0:null===(r=c.black)||void 0===r?void 0:r.rating)||Number(u.BlackElo)||void 0,p=((null==c?void 0:c.site)||u.Site||"unknown").toLowerCase().includes("chess.com"),w=s(h,p&&!!h&&"White"!==h),y=s(g,p&&!!g&&"Black"!==g);return{white:{name:h,rating:v,avatarUrl:null!=w?w:void 0},black:{name:g,rating:f,avatarUrl:null!=y?y:void 0}}},s=(e,t)=>{let{data:n}=(0,l.I)({queryKey:["CCAvatar",e],enabled:t,queryFn:()=>(0,r.e)(e),staleTime:36e5,gcTime:864e5});return n}},97121:(e,t,n)=>{"use strict";n.d(t,{s:()=>r});var a=n(37876),i=n(77328),l=n.n(i);let r=e=>{let{title:t}=e;return(0,a.jsxs)(l(),{children:[(0,a.jsx)("title",{children:t}),(0,a.jsx)("meta",{property:"og:title",content:t})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[774,969,696,358,649,585,636,593,792],()=>t(23876)),_N_E=e.O()}]);