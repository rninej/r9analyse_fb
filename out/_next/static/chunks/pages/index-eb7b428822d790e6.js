(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{8207:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var i=n(14232),a=n.t(i,2),r=n(99659),o=n(32432),s=n(76975);let l={...a}.useSyncExternalStore;function d(e={}){let{themeId:t}=e;return function(e,n={}){let a=(0,s.A)();a&&t&&(a=a[t]||a);let d="undefined"!=typeof window&&void 0!==window.matchMedia,{defaultMatches:c=!1,matchMedia:h=d?window.matchMedia:null,ssrMatchMedia:u=null,noSsr:m=!1}=(0,o.A)({name:"MuiUseMediaQuery",props:n,theme:a}),g="function"==typeof e?e(a):e;return(void 0!==l?function(e,t,n,a,r){let o=i.useCallback(()=>t,[t]),s=i.useMemo(()=>{if(r&&n)return()=>n(e).matches;if(null!==a){let{matches:t}=a(e);return()=>t}return o},[o,e,a,r,n]),[d,c]=i.useMemo(()=>{if(null===n)return[o,()=>()=>{}];let t=n(e);return[()=>t.matches,e=>(t.addEventListener("change",e),()=>{t.removeEventListener("change",e)})]},[o,n,e]);return l(c,d,s)}:function(e,t,n,a,o){let[s,l]=i.useState(()=>o&&n?n(e).matches:a?a(e).matches:t);return(0,r.A)(()=>{if(!n)return;let t=n(e),i=()=>{l(t.matches)};return i(),t.addEventListener("change",i),()=>{t.removeEventListener("change",i)}},[e,n]),s})(g=g.replace(/^@media( ?)/m,""),c,h,u,m)}}d();let c=d({themeId:n(3637).A})},16760:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(28798)}])},28798:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>tr});var i=n(37876),a=n(52547),r=n(30566),o=n(8207),s=n(31084),l=n(11494),d=n(71538),c=n(49516),h=n(46061),u=n(84147),m=n(47866),g=n(3034),p=n(85278),x=n(14232),v=n(69241),f=n(4697),j=n(68197),y=n(80027),A=n(47951),w=n(45879);function b(e){return(0,w.Ay)("MuiFab",e)}let I=(0,A.A)("MuiFab",["root","primary","secondary","extended","circular","focusVisible","disabled","colorInherit","sizeSmall","sizeMedium","sizeLarge","info","error","warning","success"]);var k=n(68275),C=n(54773),S=n(82987),z=n(78457),E=n(52196);let M=e=>{let{color:t,variant:n,classes:i,size:a}=e,r={root:["root",n,"size".concat((0,y.A)(a)),"inherit"===t?"colorInherit":t]},o=(0,f.A)(r,b,i);return{...i,...o}},W=(0,C.Ay)(j.A,{name:"MuiFab",slot:"Root",shouldForwardProp:e=>(0,k.A)(e)||"classes"===e,overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,t[n.variant],t["size".concat((0,y.A)(n.size))],"inherit"===n.color&&t.colorInherit,t[(0,y.A)(n.size)],t[n.color]]}})((0,S.A)(e=>{var t,n;let{theme:i}=e;return{...i.typography.button,minHeight:36,transition:i.transitions.create(["background-color","box-shadow","border-color"],{duration:i.transitions.duration.short}),borderRadius:"50%",padding:0,minWidth:0,width:56,height:56,zIndex:(i.vars||i).zIndex.fab,boxShadow:(i.vars||i).shadows[6],"&:active":{boxShadow:(i.vars||i).shadows[12]},color:i.vars?i.vars.palette.text.primary:null===(t=(n=i.palette).getContrastText)||void 0===t?void 0:t.call(n,i.palette.grey[300]),backgroundColor:(i.vars||i).palette.grey[300],"&:hover":{backgroundColor:(i.vars||i).palette.grey.A100,"@media (hover: none)":{backgroundColor:(i.vars||i).palette.grey[300]},textDecoration:"none"},["&.".concat(I.focusVisible)]:{boxShadow:(i.vars||i).shadows[6]},variants:[{props:{size:"small"},style:{width:40,height:40}},{props:{size:"medium"},style:{width:48,height:48}},{props:{variant:"extended"},style:{borderRadius:24,padding:"0 16px",width:"auto",minHeight:"auto",minWidth:48,height:48}},{props:{variant:"extended",size:"small"},style:{width:"auto",padding:"0 8px",borderRadius:17,minWidth:34,height:34}},{props:{variant:"extended",size:"medium"},style:{width:"auto",padding:"0 16px",borderRadius:20,minWidth:40,height:40}},{props:{color:"inherit"},style:{color:"inherit"}}]}}),(0,S.A)(e=>{let{theme:t}=e;return{variants:[...Object.entries(t.palette).filter((0,z.A)(["dark","contrastText"])).map(e=>{let[n]=e;return{props:{color:n},style:{color:(t.vars||t).palette[n].contrastText,backgroundColor:(t.vars||t).palette[n].main,"&:hover":{backgroundColor:(t.vars||t).palette[n].dark,"@media (hover: none)":{backgroundColor:(t.vars||t).palette[n].main}}}}})]}}),(0,S.A)(e=>{let{theme:t}=e;return{["&.".concat(I.disabled)]:{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground}}})),P=x.forwardRef(function(e,t){let n=(0,E.b)({props:e,name:"MuiFab"}),{children:a,className:r,color:o="default",component:s="button",disabled:l=!1,disableFocusRipple:d=!1,focusVisibleClassName:c,size:h="large",variant:u="circular",...m}=n,g={...n,color:o,component:s,disabled:l,disableFocusRipple:d,size:h,variant:u},p=M(g);return(0,i.jsx)(W,{className:(0,v.A)(p.root,r),component:s,disabled:l,focusRipple:!d,focusVisibleClassName:(0,v.A)(p.focusVisible,c),ownerState:g,ref:t,...m,classes:p,children:a})});var R=n(18259),L=n(19271),X=n(77018),_=n(88713),F=n(90405),K=n(35779),G=n(83290),N=n(6003),B=n(78523),T=n(24705),$=n(35656),H=n(82260),Y=n(37242);function V(){let[e,t]=(0,Y.v)("show-arrow-best-move",a.XL),[n,r]=(0,Y.v)("show-icon-player-move",a.a2);return(0,i.jsxs)(s.A,{container:!0,justifyContent:"space-evenly",alignItems:"center",size:12,gap:3,children:[(0,i.jsx)($.A,{control:(0,i.jsx)(H.A,{checked:e,onChange:(e,n)=>t(n)}),label:"Show engine best move arrow",sx:{marginX:0}}),(0,i.jsx)($.A,{control:(0,i.jsx)(H.A,{checked:n,onChange:(e,t)=>r(t)}),label:"Show played move icon",sx:{marginX:0}})]})}var D=n(47713),O=n(43699),U=n(99509),Q=n(54587),q=n.n(Q),J=n(92094),Z=n(92634);function ee(e){let{open:t,onClose:n}=e,[o,d]=(0,Y.v)("engine-depth",a.B2),[c,h]=(0,Y.v)("engine-multi-pv",a.FR),[v,f]=(0,Y.v)("engine-name",a.Ju),[j,y]=(0,p.fp)(U.U),[A,w]=(0,p.fp)(U._),[b,I]=(0,p.fp)(a.pN),k="dark"===(0,r.A)().palette.mode;return(0,x.useEffect)(()=>{(0,D.N9)(v)||(O.m.isSupported()?f(L.Qz.Stockfish16_1Lite):f(L.Qz.Stockfish11))},[f,v]),(0,i.jsxs)(u.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,children:[(0,i.jsx)(m.A,{variant:"h5",sx:{paddingBottom:1},children:"Settings"}),(0,i.jsx)(g.A,{sx:{paddingBottom:0},children:(0,i.jsxs)(s.A,{container:!0,justifyContent:"center",alignItems:"center",paddingTop:1,spacing:3,size:12,children:[(0,i.jsx)(s.A,{container:!0,justifyContent:"center",size:{xs:12,sm:7,md:8},children:(0,i.jsxs)(X.A,{variant:"body2",children:[J.H[J.T3].small," is the default engine if your device support its requirements. It offers the best balance between speed and strength."," ",J.H[J.RS].small," is the strongest engine available, note that it requires a one time download of"," ",J.H[J.RS].sizeMb,"MB and is much more compute intensive."]})}),(0,i.jsx)(s.A,{container:!0,justifyContent:"center",size:{xs:12,sm:5,md:4},children:(0,i.jsxs)(_.A,{variant:"outlined",children:[(0,i.jsx)(F.A,{id:"dialog-select-label",children:"Engine"}),(0,i.jsx)(K.A,{labelId:"dialog-select-label",id:"dialog-select",displayEmpty:!0,input:(0,i.jsx)(G.A,{label:"Engine"}),value:v,onChange:e=>f(e.target.value),sx:{width:280,maxWidth:"100%"},children:Object.values(L.Qz).map(e=>(0,i.jsx)(N.A,{value:e,disabled:!(0,D.N9)(e),children:J.H[e].full},e))})]})}),(0,i.jsx)(R.A,{label:"Maximum depth",value:o,setValue:d,min:10,max:30,marksFilter:2}),(0,i.jsx)(R.A,{label:"Number of lines",value:c,setValue:h,min:2,max:6,marksFilter:1,size:6}),(0,i.jsx)(V,{}),(0,i.jsx)(s.A,{container:!0,justifyContent:"center",size:{xs:12,sm:8,md:9},children:(0,i.jsx)(R.A,{label:"Board hue",value:j,setValue:y,min:0,max:360})}),(0,i.jsx)(s.A,{container:!0,justifyContent:"center",alignItems:"center",size:{xs:12,sm:4,md:3},children:(0,i.jsxs)(_.A,{variant:"outlined",children:[(0,i.jsx)(F.A,{id:"dialog-select-label",children:"Piece set"}),(0,i.jsx)(K.A,{labelId:"dialog-select-label",id:"dialog-select",displayEmpty:!0,input:(0,i.jsx)(G.A,{label:"Piece set"}),value:A,onChange:e=>w(e.target.value),sx:{width:200,maxWidth:"100%"},children:J.PE.map(e=>(0,i.jsx)(N.A,{value:e,children:(0,i.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,i.jsx)(q(),{loading:"lazy",src:"/piece/".concat(e,"/").concat(k?"w":"b","N.svg"),alt:"".concat(e," knight"),width:24,height:24}),e]})},e))})]})}),(0,i.jsx)(s.A,{container:!0,justifyContent:"center",alignItems:"center",size:{xs:12,md:11},children:(0,i.jsx)(R.A,{label:"Number of threads",value:b,setValue:I,min:1,max:12,marksFilter:1,infoContent:(0,i.jsxs)(i.Fragment,{children:["More threads means faster analysis, but only if your device can handle them, otherwise it may have the opposite effect. The estimated optimal value for your device is"," ",(0,Z.PN)(),". Due to privacy restrictions in some browsers, this value might be underestimated. Don't hesitate to try different values to find the best one for your device."]})})})]})}),(0,i.jsx)(B.A,{sx:{m:1},children:(0,i.jsx)(T.A,{variant:"contained",onClick:n,children:"Close"})})]})}var et=n(98594);function en(){let[e,t]=(0,x.useState)(!1);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(P,{title:"Engine settings",color:"secondary",size:"small",sx:{top:"auto",right:16,bottom:16,left:"auto",position:"fixed"},onClick:()=>t(!0),children:(0,i.jsx)(et.In,{icon:"mdi:settings",height:20})}),(0,i.jsx)(ee,{open:e,onClose:()=>t(!1)})]})}var ei=n(89243),ea=n(97121),er=n(3816);class eo{startWatching(e){this.intervalId=setInterval(async()=>{let t=await (0,er.V)(this.username);if(t.length>0){let n=t[0];n.id!==this.lastGameId&&(this.lastGameId=n.id,e(n))}},1e4)}stopWatching(){this.intervalId&&clearInterval(this.intervalId)}constructor(e){this.lastGameId=null,this.intervalId=null,this.username=e}}var es=n(22277),el=n(89099),ed=n(69846),ec=n(19410),eh=n(82831);function eu(){let e=(0,ed.l)(),t=(0,p.md)(a.MA),n=(0,p.md)(a.XL),{white:r,black:o}=(0,eh.K)(a._X),s=(0,x.useMemo)(()=>{var t;let n=e.width,i=e.height;return(null===(t=window)||void 0===t?void 0:t.innerWidth)<1200?Math.min(n-15,i-150):Math.min(n-700,.92*i)},[e]);return(0,i.jsx)(ec.h,{id:"AnalysisBoard",boardSize:s,canPlay:!0,gameAtom:a.Sd,whitePlayer:r,blackPlayer:o,boardOrientation:t?L.Q1.White:L.Q1.Black,currentPositionAtom:a.eU,showBestMoveArrow:n,showPlayerMoveIconAtom:a.a2,showEvaluationBar:!0})}var em=n(27064);function eg(){let{gameFromUrl:e}=(0,em.R)(),t=(0,p.md)(a._X).getHeaders();if(!(void 0!==e||t.White&&"?"!==t.White))return null;let n=(null==e?void 0:e.termination)||t.Termination||"?",r=n.split(" ").length>2?n:(null==e?void 0:e.result)||t.Result||"?";return(0,i.jsxs)(s.A,{container:!0,justifyContent:"space-evenly",alignItems:"center",rowGap:1,columnGap:3,size:11,children:[(0,i.jsx)(s.A,{container:!0,justifyContent:"center",alignItems:"center",size:"grow",children:(0,i.jsxs)(X.A,{noWrap:!0,fontSize:"0.9rem",children:["Site : ",(null==e?void 0:e.site)||t.Site||"?"]})}),(0,i.jsx)(s.A,{container:!0,justifyContent:"center",alignItems:"center",size:"grow",children:(0,i.jsxs)(X.A,{noWrap:!0,fontSize:"0.9rem",children:["Date : ",(null==e?void 0:e.date)||t.Date||"?"]})}),(0,i.jsx)(s.A,{container:!0,justifyContent:"center",alignItems:"center",size:"grow",children:(0,i.jsxs)(X.A,{noWrap:!0,fontSize:"0.9rem",children:["Result : ",r]})})]})}var ep=n(88546),ex=n(65897),ev=n(3242);function ef(){let e=(0,el.useRouter)(),t=(0,p.md)(a._X),{setPgn:n}=(0,ex.j)(a._X),{resetToStartingPosition:r}=(0,ex.j)(a.Sd),{gameFromUrl:o}=(0,em.R)(),s=(0,p.Xr)(a.Mx),l=(0,p.Xr)(a.MA),d=(0,p.md)(a.xg),c=(0,x.useMemo)(()=>t.history().join(),[t]),h=(0,x.useCallback)((e,t,i)=>{let a=new es.d$;a.loadPgn(e),c!==a.history().join()&&(r(e),s(i),n(e),l(null==t||t))},[c,r,n,s,l]),{lichessGameId:u,orientation:m}=e.query;(0,x.useEffect)(()=>{let e=async e=>{let t=await (0,ev.e1)(e);"string"==typeof t&&h(t,"black"!==m)};if(o){let e="Chesskit.org"!==o.site||"You"!==o.black.name;h(o.pgn,e,o.eval)}else"string"==typeof u&&u&&e(u)},[o,u,m,h]),(0,x.useEffect)(()=>{let e=e=>{try{var t;if(!(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.pgn))return;let{pgn:n,orientation:i}=e.data;h(n,"black"!==i)}catch(e){console.error("Error processing message event:",e)}};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[h]);let g=void 0!==o||!!t.getHeaders().White&&"?"!==t.getHeaders().White||t.history().length>0;return d?null:(0,i.jsx)(ep.A,{label:g?"Load another game":"Load game",size:"small",setGame:async t=>{await e.push("/"),h(t.pgn())}})}var ej=n(24307),ey=n(27449),eA=n(7045),ew=n(7957),eb=n(581);function eI(e){return(0,w.Ay)("MuiLoadingButton",e)}let ek=(0,A.A)("MuiLoadingButton",["root","label","loading","loadingIndicator","loadingIndicatorCenter","loadingIndicatorStart","loadingIndicatorEnd","endIconLoadingEnd","startIconLoadingStart"]),eC=e=>{let{loading:t,loadingPosition:n,classes:i}=e,a={root:["root",t&&"loading"],label:["label"],startIcon:[t&&`startIconLoading${(0,y.A)(n)}`],endIcon:[t&&`endIconLoading${(0,y.A)(n)}`],loadingIndicator:["loadingIndicator",t&&`loadingIndicator${(0,y.A)(n)}`]},r=(0,f.A)(a,eI,i);return{...i,...r}},eS=e=>"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e&&"classes"!==e,ez=(0,C.Ay)(T.A,{shouldForwardProp:e=>eS(e)||"classes"===e,name:"MuiLoadingButton",slot:"Root",overridesResolver:(e,t)=>[t.root,t.startIconLoadingStart&&{[`& .${ek.startIconLoadingStart}`]:t.startIconLoadingStart},t.endIconLoadingEnd&&{[`& .${ek.endIconLoadingEnd}`]:t.endIconLoadingEnd}]})((0,S.A)(({theme:e})=>({display:"inline-flex",[`& .${ek.startIconLoadingStart}, & .${ek.endIconLoadingEnd}`]:{transition:e.transitions.create(["opacity"],{duration:e.transitions.duration.short}),opacity:0},variants:[{props:{loadingPosition:"center"},style:{transition:e.transitions.create(["background-color","box-shadow","border-color"],{duration:e.transitions.duration.short}),[`&.${ek.loading}`]:{color:"transparent"}}},{props:({ownerState:e})=>"start"===e.loadingPosition&&e.fullWidth,style:{[`& .${ek.startIconLoadingStart}, & .${ek.endIconLoadingEnd}`]:{transition:e.transitions.create(["opacity"],{duration:e.transitions.duration.short}),opacity:0,marginRight:-8}}},{props:({ownerState:e})=>"end"===e.loadingPosition&&e.fullWidth,style:{[`& .${ek.startIconLoadingStart}, & .${ek.endIconLoadingEnd}`]:{transition:e.transitions.create(["opacity"],{duration:e.transitions.duration.short}),opacity:0,marginLeft:-8}}}]}))),eE=(0,C.Ay)("span",{name:"MuiLoadingButton",slot:"LoadingIndicator",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.loadingIndicator,t[`loadingIndicator${(0,y.A)(n.loadingPosition)}`]]}})((0,S.A)(({theme:e})=>({position:"absolute",visibility:"visible",display:"flex",variants:[{props:{loadingPosition:"start",size:"small"},style:{left:10}},{props:({loadingPosition:e,ownerState:t})=>"start"===e&&"small"!==t.size,style:{left:14}},{props:{variant:"text",loadingPosition:"start"},style:{left:6}},{props:{loadingPosition:"center"},style:{left:"50%",transform:"translate(-50%)",color:(e.vars||e).palette.action.disabled}},{props:{loadingPosition:"end",size:"small"},style:{right:10}},{props:({loadingPosition:e,ownerState:t})=>"end"===e&&"small"!==t.size,style:{right:14}},{props:{variant:"text",loadingPosition:"end"},style:{right:6}},{props:({ownerState:e})=>"start"===e.loadingPosition&&e.fullWidth,style:{position:"relative",left:-10}},{props:({ownerState:e})=>"end"===e.loadingPosition&&e.fullWidth,style:{position:"relative",right:-10}}]}))),eM=(0,C.Ay)("span",{name:"MuiLoadingButton",slot:"Label",overridesResolver:(e,t)=>[t.label]})({display:"inherit",alignItems:"inherit",justifyContent:"inherit"}),eW=x.forwardRef(function(e,t){let n=x.useContext(eA.A),a=(0,eb.A)(n,e),r=(0,E.b)({props:a,name:"MuiLoadingButton"}),{children:o,disabled:s=!1,id:l,loading:d=!1,loadingIndicator:c,loadingPosition:h="center",variant:u="text",...m}=r,g=(0,ey.A)(l),p=c??(0,i.jsx)(ew.A,{"aria-labelledby":g,color:"inherit",size:16}),v={...r,disabled:s,loading:d,loadingIndicator:p,loadingPosition:h,variant:u},f=eC(v),j=d?(0,i.jsx)(eE,{className:f.loadingIndicator,ownerState:v,children:p}):null;return(0,i.jsxs)(ez,{disabled:s||d,id:g,ref:t,...m,variant:u,classes:f,ownerState:v,children:["end"===v.loadingPosition?(0,i.jsx)(eM,{className:f.label,children:o}):j,"end"===v.loadingPosition?j:(0,i.jsx)(eM,{className:f.label,children:o})]})});var eP=n(32253),eR=n(9320),eL=n(29791),eX=n(44371);let e_=e=>{let[t,n]=(0,p.fp)(a.eU),i=(0,p.md)(a.Mx),r=(0,p.md)(a._X),o=(0,p.md)(a.Sd),s=(0,p.md)(a.B2),l=(0,p.md)(a.FR),[d,c]=(0,p.fp)(a.Sp);return(0,x.useEffect)(()=>{var t;let a=o.history({verbose:!0}),h={lastMove:a.at(-1)},u=r.history();if(a.length<=u.length&&u.slice(0,a.length).join()===a.map(e=>e.san).join()&&(h.currentMoveIdx=a.length,i)){let e=a.length;h.eval={...i.positions[e],lines:i.positions[e].lines.slice(0,l)},h.lastEval=e>0?{...i.positions[e-1],lines:i.positions[e-1].lines.slice(0,l)}:void 0}if(!(null===(t=h.eval)||void 0===t?void 0:t.opening))for(let e of a.slice().reverse()){let t=e.after.split(" ")[0],n=eX.m.find(e=>e.fen===t);if(n){h.opening=n.name;break}}if(n(h),!h.eval&&(null==e?void 0:e.getIsReady())&&e.name&&!o.isCheckmate()&&!o.isStalemate()){let t=async(t,n)=>{var i,a,r;if(!e.getIsReady())throw Error("Engine not ready");let o=d[t];if(o&&o.engine===e.name&&(null!==(a=null===(i=o.lines)||void 0===i?void 0:i.length)&&void 0!==a?a:0)>=l&&(null!==(r=o.lines[0].depth)&&void 0!==r?r:0)>=s){let e={...o,lines:o.lines.slice(0,l)};return null==n||n(e),e}let h=await e.evaluatePositionWithUpdate({fen:t,depth:s,multiPv:l,setPartialEval:n});return c(n=>({...n,[t]:{...h,engine:e.name}})),h};(async()=>{let e=await t(o.fen(),e=>{n({...h,eval:e})});if(0===a.length)return;let i=(0,ej.kf)(o),r=i.fens.slice("w"===o.turn()?-3:-4),s=i.uciMoves.slice("w"===o.turn()?-2:-3),l=await t(r.slice(-2)[0]),d=r.map((t,n)=>n===r.length-2?l:n===r.length-1?e:{lines:[{pv:[],depth:0,multiPv:1,cp:1}]}),c=(0,eL.R)(d,s,r);n({...h,eval:c.slice(-1)[0],lastEval:c.slice(-2)[0]})})()}return()=>{(null==e?void 0:e.getIsReady())&&(null==e||e.stopAllCurrentJobs())}},[i,o,r,e,s,l]),t};function eF(){let e=(0,p.md)(a.Ju),t=(0,eP.K)(e);e_(t);let n=(0,p.md)(a.pN),[r,o]=(0,p.fp)(a.xg),s=(0,p.md)(a.B2),l=(0,p.md)(a.FR),{setGameEval:d,gameFromUrl:c}=(0,em.R)(),[h,u]=(0,p.fp)(a.Mx),m=(0,p.md)(a._X),g=(0,p.Xr)(a.Sp),{white:v,black:f}=(0,eh.K)(a._X),j=(null==t?void 0:t.getIsReady())&&m.history().length>0&&!r,y=(0,x.useCallback)(async()=>{let i=(0,ej.kf)(m);if(!(null==t?void 0:t.getIsReady())||0===i.fens.length||r)return;let a=await t.evaluateGame({...i,depth:s,multiPv:l,setEvaluationProgress:o,playersRatings:{white:null==v?void 0:v.rating,black:null==f?void 0:f.rating},workersNb:n});u(a),o(0),c&&d(c.id,a);let h=i.fens.reduce((t,n,i)=>(t[n]={...a.positions[i],engine:e},t),{});g(e=>({...e,...h})),(0,eR.$)("analyze_game",{engine:e,depth:s,multiPv:l,nbPositions:i.fens.length})},[t,e,n,m,s,l,r,o,u,c,d,g,v.rating,f.rating]);return((0,x.useEffect)(()=>{o(0)},[t,o]),(0,x.useEffect)(()=>{!h&&j&&y()},[h,j,y]),r)?null:(0,i.jsx)(eW,{variant:"contained",size:"small",startIcon:(0,i.jsx)(et.In,{icon:"streamline:magnifying-glass-solid",height:12}),onClick:y,disabled:!j,children:(0,i.jsx)(X.A,{fontSize:"0.9em",fontWeight:"500",lineHeight:"1.4em",children:h?"Analyze again":"Analyze"})})}var eK=n(75328),eG=n(6800);let eN=e=>0===e.value?null:(0,i.jsxs)(s.A,{container:!0,alignItems:"center",justifyContent:"center",wrap:"nowrap",width:"90%",columnGap:2,size:12,children:[(0,i.jsx)(X.A,{variant:"caption",align:"center",children:e.label}),(0,i.jsx)(s.A,{sx:{width:"100%"},children:(0,i.jsx)(eK.A,{variant:"determinate",...e,sx:e=>({borderRadius:"5px",height:"5px",["&.".concat(eG.A.colorPrimary)]:{backgroundColor:e.palette.grey["light"===e.palette.mode?200:700]},["& .".concat(eG.A.bar)]:{borderRadius:5,backgroundColor:J.sl}})})}),(0,i.jsx)(s.A,{children:(0,i.jsx)(X.A,{variant:"body2",color:"text.secondary",children:"".concat(Math.round(e.value),"%")})})]});function eB(){let e=(0,p.md)(a.xg);return(0,i.jsxs)(s.A,{container:!0,justifyContent:"center",alignItems:"center",rowGap:2,size:12,children:[(0,i.jsxs)(s.A,{container:!0,justifyContent:"center",alignItems:"center",columnGap:1,size:12,children:[(0,i.jsx)(et.In,{icon:"streamline:clipboard-check",height:24}),(0,i.jsx)(X.A,{variant:"h5",align:"center",children:"Game Analysis"})]}),(0,i.jsxs)(s.A,{container:!0,justifyContent:"center",alignItems:"center",rowGap:2,columnGap:12,size:12,children:[(0,i.jsx)(eg,{}),(0,i.jsx)(ef,{}),(0,i.jsx)(eF,{}),(0,i.jsx)(eN,{value:e,label:"Analyzing..."})]})]})}var eT=n(22430),e$=n(70946);function eH(){let e=(0,p.Xr)(a.MA);return(0,x.useEffect)(()=>{let t=t=>{"f"===t.key&&e(e=>!e)};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[e]),(0,i.jsx)(eT.A,{title:"Flip board",children:(0,i.jsx)(e$.A,{onClick:()=>e(e=>!e),sx:{paddingX:1.2,paddingY:.5},children:(0,i.jsx)(et.In,{icon:"eva:flip-fill"})})})}function eY(){let{playMove:e}=(0,ex.j)(a.Sd),t=(0,p.md)(a._X),n=(0,p.md)(a.Sd),r=t.history(),o=n.history(),l=o.length<r.length&&r.slice(0,o.length).join()===o.join(),d=(0,x.useCallback)(()=>{var n;if(!l)return;let i=o.length,a=t.history({verbose:!0})[i],r=null===(n=t.getComments().find(e=>e.fen===a.after))||void 0===n?void 0:n.comment;a&&e({from:a.from,to:a.to,promotion:a.promotion,comment:r})},[l,o,t,e]);return(0,x.useEffect)(()=>{let e=e=>{"ArrowRight"===e.key&&d()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[d]),(0,i.jsx)(eT.A,{title:"Go to next move",children:(0,i.jsx)(s.A,{children:(0,i.jsx)(e$.A,{onClick:()=>d(),disabled:!l,sx:{paddingX:1.2,paddingY:.5},children:(0,i.jsx)(et.In,{icon:"ri:arrow-right-s-line",height:30})})})})}function eV(){let{setPgn:e}=(0,ex.j)(a.Sd),t=(0,p.md)(a._X),n=(0,p.md)(a.Sd),r=t.history(),o=n.history()>=r;return(0,x.useEffect)(()=>{let n=n=>{"ArrowUp"!==n.key||o||e(t.pgn())};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}},[o,e,t]),(0,i.jsx)(eT.A,{title:"Go to final position",children:(0,i.jsx)(s.A,{children:(0,i.jsx)(e$.A,{onClick:()=>{o||e(t.pgn())},disabled:o,sx:{paddingX:1.2,paddingY:.5},children:(0,i.jsx)(et.In,{icon:"ri:skip-forward-line"})})})})}function eD(){let e=(0,p.md)(a._X),t=(0,p.md)(a.Sd),n=(0,p.md)(a.Mx),{addGame:r,setGameEval:o,gameFromUrl:l}=(0,em.R)(),d=(0,el.useRouter)(),c=!l&&(t.history().length||e.history().length),h=async()=>{if(!c)return;let i=(0,ej.FA)(e,t),a=await r(i);n&&await o(a,n),d.replace({query:{gameId:a},pathname:d.pathname},void 0,{shallow:!0,scroll:!1})};return(0,i.jsx)(i.Fragment,{children:l?(0,i.jsx)(eT.A,{title:"Game saved in database",children:(0,i.jsx)(s.A,{children:(0,i.jsx)(e$.A,{disabled:!0,sx:{paddingX:1.2,paddingY:.5},children:(0,i.jsx)(et.In,{icon:"ri:folder-check-line"})})})}):(0,i.jsx)(eT.A,{title:"Save game",children:(0,i.jsx)(s.A,{children:(0,i.jsx)(e$.A,{onClick:h,disabled:!c,sx:{paddingX:1.2,paddingY:.5},children:(0,i.jsx)(et.In,{icon:"ri:save-3-line"})})})})})}function eO(){let e=(0,p.md)(a.Sd),{resetToStartingPosition:t,undoMove:n}=(0,ex.j)(a.Sd),r=e.history(),o=(0,p.md)(a._X);return(0,x.useEffect)(()=>{let e=e=>{0!==r.length&&("ArrowLeft"===e.key?n():"ArrowDown"===e.key&&t())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[n,r,t,e]),(0,i.jsxs)(s.A,{container:!0,justifyContent:"center",alignItems:"center",size:12,children:[(0,i.jsx)(eH,{}),(0,i.jsx)(eT.A,{title:"Reset board",children:(0,i.jsx)(s.A,{children:(0,i.jsx)(e$.A,{onClick:()=>t(),disabled:0===r.length,sx:{paddingX:1.2,paddingY:.5},children:(0,i.jsx)(et.In,{icon:"ri:skip-back-line"})})})}),(0,i.jsx)(eT.A,{title:"Go to previous move",children:(0,i.jsx)(s.A,{children:(0,i.jsx)(e$.A,{onClick:()=>n(),disabled:0===r.length,sx:{paddingX:1.2,paddingY:.5},children:(0,i.jsx)(et.In,{icon:"ri:arrow-left-s-line",height:30})})})}),(0,i.jsx)(eY,{}),(0,i.jsx)(eV,{}),(0,i.jsx)(eT.A,{title:"Copy pgn",children:(0,i.jsx)(s.A,{children:(0,i.jsx)(e$.A,{disabled:0===o.history().length,onClick:()=>{var e,t;null===(t=navigator.clipboard)||void 0===t||null===(e=t.writeText)||void 0===e||e.call(t,o.pgn())},sx:{paddingX:1.2,paddingY:.5},children:(0,i.jsx)(et.In,{icon:"ri:clipboard-line"})})})}),(0,i.jsx)(eD,{})]})}var eU=n(9227),eQ=n(34428),eq=n(68327),eJ=n(79534),eZ=n.n(eJ);function e0(e){let{san:t,color:n,additionalText:a,typographyProps:o,boxProps:s}=e,d="dark"===(0,r.A)().palette.mode,{icon:c,text:h}=(0,x.useMemo)(()=>{let e=t.charAt(0);if(!["K","Q","R","B","N"].includes(e))return{text:t};let i=d?n:"w"===n?"b":"w";return{icon:e1[e][i],text:t.slice(1)}},[t,n,d]);return(0,i.jsxs)(l.A,{component:"span",...s,children:[c&&(0,i.jsx)(X.A,{component:"span",fontFamily:eZ().style.fontFamily,...o,children:c}),(0,i.jsxs)(X.A,{component:"span",noWrap:!0,...o,children:[h,a]})]})}let e1={K:{w:"♚",b:"♔"},Q:{w:"♛",b:"♕"},R:{w:"♜",b:"♖"},B:{w:"♝",b:"♗"},N:{w:"♞",b:"♘"}};function e2(){var e,t,n,r,o,s,l,d;let c=(0,p.md)(a.eU),h=(0,p.md)(a.Sd),u=null==c?void 0:null===(e=c.lastEval)||void 0===e?void 0:e.bestMove,m=(0,x.useMemo)(()=>{var e;if(!u)return;let t=null===(e=h.history({verbose:!0}).at(-1))||void 0===e?void 0:e.before;if(t)return(0,ej.AC)(t)(u)},[u,h]);if(0===h.history().length)return null;if(!m)return(0,i.jsx)(eU.A,{direction:"row",alignItems:"center",columnGap:5,marginTop:.8,children:(0,i.jsx)(eq.A,{variant:"rounded",animation:"wave",width:"12em",sx:{color:"transparent",maxWidth:"7vw"},children:(0,i.jsx)(X.A,{align:"center",fontSize:"0.9rem",children:"placeholder"})})});let g=null===(t=c.eval)||void 0===t?void 0:t.moveClassification,v=g!==L.eK.Best&&g!==L.eK.Opening&&g!==L.eK.Forced&&g!==L.eK.Splendid&&g!==L.eK.Perfect;return(0,i.jsxs)(eU.A,{direction:"row",alignItems:"center",justifyContent:"center",columnGap:4,marginTop:.5,flexWrap:"wrap",children:[g&&(0,i.jsxs)(eU.A,{direction:"row",alignItems:"center",spacing:1,children:[(0,i.jsx)(q(),{src:"/icons/".concat(g,".png"),alt:"move-icon",width:16,height:16,style:{maxWidth:"3.5vw",maxHeight:"3.5vw"}}),(0,i.jsx)(e0,{typographyProps:{fontSize:"0.9rem"},san:null!==(s=null===(n=c.lastMove)||void 0===n?void 0:n.san)&&void 0!==s?s:"",color:null!==(l=null===(r=c.lastMove)||void 0===r?void 0:r.color)&&void 0!==l?l:"w",additionalText:" is "+e5[g]})]}),v&&(0,i.jsxs)(eU.A,{direction:"row",alignItems:"center",spacing:1,children:[(0,i.jsx)(q(),{src:"/icons/best.png",alt:"move-icon",width:16,height:16,style:{maxWidth:"3.5vw",maxHeight:"3.5vw"}}),(0,i.jsx)(e0,{typographyProps:{fontSize:"0.9rem"},san:m,color:null!==(d=null===(o=c.lastMove)||void 0===o?void 0:o.color)&&void 0!==d?d:"w",additionalText:" was the best move"})]})]})}let e5={[L.eK.Opening]:"an opening move",[L.eK.Forced]:"forced",[L.eK.Splendid]:"splendid !!",[L.eK.Perfect]:"the only good move !",[L.eK.Best]:"the best move",[L.eK.Excellent]:"excellent",[L.eK.Okay]:"an okay move",[L.eK.Inaccuracy]:"an inaccuracy",[L.eK.Mistake]:"a mistake",[L.eK.Blunder]:"a blunder"};function e9(){var e;let t=(0,p.md)(a.eU);if(!(null==t?void 0:t.lastMove))return null;let n=(null==t?void 0:null===(e=t.eval)||void 0===e?void 0:e.opening)||t.opening;return n?(0,i.jsx)(s.A,{children:(0,i.jsx)(X.A,{align:"center",fontSize:"0.9rem",maxWidth:"20rem",children:n})}):(0,i.jsx)(s.A,{justifyItems:"center",alignContent:"center",children:(0,i.jsx)(eq.A,{variant:"rounded",animation:"wave",width:"12em",sx:{color:"transparent",maxWidth:"7vw",maxHeight:"3.5vw"},children:(0,i.jsx)(X.A,{align:"center",fontSize:"0.9rem",children:"placeholder"})})})}var e4=n(63009),e3=n(12572);function e7(e){let{line:t}=e,n=(0,p.md)(a.Sd),{addMoves:r}=(0,ex.j)(a.Sd),o=(0,ej.l3)(t),s=void 0!==t.cp&&t.cp<0||void 0!==t.mate&&t.mate<0,l=t.depth<6,d=(0,ej.AC)(n.fen()),c=n.turn(),h=e=>e%2==0?c:"w"===c?"b":"w";return(0,i.jsxs)(e3.Ay,{disablePadding:!0,children:[(0,i.jsx)(X.A,{marginRight:1.5,marginY:.3,paddingY:.2,noWrap:!0,overflow:"visible",width:"3.5em",minWidth:"3.5em",textAlign:"center",fontSize:"0.8rem",sx:{backgroundColor:s?"black":"white",color:s?"white":"black"},borderRadius:"5px",border:"1px solid #424242",fontWeight:"500",children:l?(0,i.jsx)(eq.A,{variant:"rounded",animation:"wave",sx:{color:"transparent"},children:"placeholder"}):o}),(0,i.jsx)(X.A,{noWrap:!0,fontSize:"0.9rem",children:l?(0,i.jsx)(eq.A,{variant:"rounded",animation:"wave",width:"20em"}):t.pv.map((e,n)=>{let a=d(e),o=h(n);return(0,i.jsx)(e0,{san:a,color:o,additionalText:n<t.pv.length-1?",":"",boxProps:{onClick:()=>{r(t.pv.slice(0,n+1))},sx:{cursor:"pointer",ml:.5*!!n,transition:"opacity 0.2s ease-in-out","&:hover":{opacity:.5}}}},n)})})]})}function e6(e){var t,n;let r=(0,p.md)(a.Sd),o=(0,p.md)(a.FR),l=(0,p.md)(a.eU),d=Array.from({length:o}).map((e,t)=>({pv:["".concat(t)],depth:0,multiPv:t+1})),c=(null==l?void 0:null===(n=l.eval)||void 0===n?void 0:null===(t=n.lines)||void 0===t?void 0:t.length)?l.eval.lines:d;return r.isCheckmate()?null:(0,i.jsx)(s.A,{container:!0,justifyContent:"center",alignItems:"center",...e,children:(0,i.jsx)(e4.A,{sx:{width:"95%",padding:0},children:c.map(e=>(0,i.jsx)(e7,{line:e},e.multiPv))})})}function e8(e){let t=(0,p.md)(a.Mx),n=(0,p.md)(a._X),r=(0,p.md)(a.Sd),o=r.history(),l=n.history(),d=o.length>0&&(r.isCheckmate()||r.isDraw()||o.join()===l.join());return(0,i.jsxs)(s.A,{container:!0,size:12,justifyContent:{xs:"center",lg:t?"start":"center"},alignItems:"center",flexWrap:{lg:t?"nowrap":void 0},gap:2,marginY:{lg:t?1:void 0},paddingX:{xs:0,lg:"calc(4% - 2rem)"},...e,sx:e.hidden?{display:"none"}:e.sx,children:[(0,i.jsxs)(eU.A,{justifyContent:"center",alignItems:"center",rowGap:1,minWidth:t?"min(25rem, 95vw)":void 0,children:[t&&(0,i.jsx)(eQ.A,{title:"Accuracy",whiteValue:"".concat(t.accuracy.white.toFixed(1)," %"),blackValue:"".concat(t.accuracy.black.toFixed(1)," %")}),(null==t?void 0:t.estimatedElo)&&(0,i.jsx)(eQ.A,{title:"Game Rating",whiteValue:Math.round(t.estimatedElo.white),blackValue:Math.round(t.estimatedElo.black)}),(0,i.jsx)(e2,{}),(0,i.jsx)(e9,{}),d&&(0,i.jsx)(X.A,{align:"center",fontSize:"0.9rem",noWrap:!0,children:"Game is over"})]}),(0,i.jsx)(e6,{size:{lg:t?void 0:12}})]})}var te=n(45175);function tt(){let{white:e,black:t}=(0,eh.K)(a._X),n=(0,p.md)(a.Mx);return(null==n?void 0:n.positions.length)?(0,i.jsxs)(s.A,{container:!0,justifyContent:"center",alignItems:"center",rowGap:.7,sx:{scrollbarWidth:"thin",overflowY:"auto"},height:"100%",maxHeight:"22rem",size:12,children:[(0,i.jsxs)(s.A,{container:!0,alignItems:"center",justifyContent:"space-evenly",wrap:"nowrap",size:12,children:[(0,i.jsx)(X.A,{width:"12rem",align:"center",noWrap:!0,fontSize:"0.9rem",children:e.name}),(0,i.jsx)(X.A,{width:"10rem"}),(0,i.jsx)(X.A,{width:"12rem",align:"center",noWrap:!0,fontSize:"0.9rem",children:t.name})]}),tn.map(e=>(0,i.jsx)(te.A,{classification:e},e))]}):null}let tn=[L.eK.Splendid,L.eK.Perfect,L.eK.Best,L.eK.Excellent,L.eK.Okay,L.eK.Opening,L.eK.Inaccuracy,L.eK.Mistake,L.eK.Blunder];function ti(e){return(0,i.jsx)(s.A,{container:!0,justifyContent:"center",alignItems:"center",size:12,flexGrow:1,...e,sx:{...e.hidden?{display:"none"}:{overflow:"hidden",...e.sx},flexDirection:"column"},children:(0,i.jsx)(tt,{})})}var ta=n(55663);function tr(){let e=(0,r.A)(),t=(0,o.A)(e.breakpoints.up("lg")),{chessComUsername:n}=(0,el.useRouter)().query,v=(0,p.md)(a.XZ)||n,f=(0,p.md)(a.Mx),j=(0,p.md)(a._X),y=(0,p.md)(a.Sd),A=(0,p.Xr)(a._X),w=j.history().length>0||y.history().length>0,[b,I]=(0,x.useState)(null),[k,C]=(0,x.useState)(null),[S,z]=(0,x.useState)(!1);return(0,x.useEffect)(()=>{if(k){let e=new es.d$;e.loadPgn(k.pgn),A(e),z(!0)}},[k,A]),(0,x.useEffect)(()=>{if(f&&S){try{"serviceWorker"in navigator&&navigator.serviceWorker.controller?navigator.serviceWorker.getRegistration().then(e=>{e&&e.showNotification("Game Analysis Complete",{body:"Your new game has been automatically analyzed."})}):new Notification("Game Analysis Complete",{body:"Your new game has been automatically analyzed."})}catch(e){console.error("Failed to create notification:",e)}z(!1)}},[f,S]),(0,x.useEffect)(()=>{if("string"==typeof v&&v){let e=()=>{let e=new eo(v);e.startWatching(e=>{C(e)}),I(e)};"granted"!==Notification.permission?Notification.requestPermission().then(t=>{"granted"===t&&e()}):e()}return()=>{null==b||b.stopWatching()}},[v]),(0,i.jsxs)(s.A,{container:!0,gap:4,justifyContent:"space-evenly",alignItems:"start",children:[(0,i.jsx)(ea.s,{title:"MrAnalyse Game Analysis"}),(0,i.jsx)(eu,{}),(0,i.jsxs)(s.A,{container:!0,justifyContent:"start",alignItems:"center",borderRadius:2,border:1,borderColor:"secondary.main",sx:{backgroundColor:"secondary.main",borderColor:"primary.main",borderWidth:2,boxShadow:"0 2px 10px rgba(0, 0, 0, 0.5)"},padding:2,style:{maxWidth:"1200px"},rowGap:2,height:{xs:"auto",lg:"calc(95vh - 60px)"},display:"flex",flexDirection:"column",flexWrap:"nowrap",size:{xs:12,lg:"grow"},children:[t?(0,i.jsxs)(l.A,{width:"100%",children:[(0,i.jsx)(eB,{},"analysis-panel-header"),(0,i.jsx)(d.A,{sx:{marginX:"5%",marginTop:2.5}})]}):(0,i.jsx)(eO,{},"review-panel-toolbar"),!t&&!f&&(0,i.jsx)(d.A,{sx:{marginX:"5%"}}),!t&&!f&&(0,i.jsx)(eB,{},"analysis-panel-header"),t?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ei.A,{id:"tabContent2"}),(0,i.jsx)(e8,{id:"tabContent0"}),(0,i.jsx)(ti,{id:"tabContent1"})]}):(0,i.jsxs)(l.A,{width:"100%",display:"flex",flexDirection:"column",alignItems:"center",children:[(0,i.jsx)(e8,{id:"tabContent0"}),f&&(0,i.jsx)(d.A,{sx:{width:"90%",my:2}}),f&&(0,i.jsx)(ei.A,{id:"tabContent2"}),w&&(0,i.jsx)(d.A,{sx:{width:"90%",my:2}}),w&&(0,i.jsx)(ti,{id:"tabContent1"})]}),t&&(0,i.jsxs)(l.A,{width:"100%",children:[(0,i.jsx)(d.A,{sx:{marginX:"5%",marginBottom:1.5}}),(0,i.jsx)(eO,{},"review-panel-toolbar")]}),!t&&f&&(0,i.jsxs)(l.A,{width:"100%",children:[(0,i.jsx)(d.A,{sx:{marginX:"5%",marginBottom:2.5}}),(0,i.jsx)(eB,{},"analysis-panel-header")]})]}),(0,i.jsx)(en,{}),(0,i.jsx)(c.A,{open:!!k,autoHideDuration:6e3,onClose:()=>C(null),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,i.jsxs)(h.A,{onClose:()=>C(null),severity:"success",sx:{width:"100%"},children:["New game found: ",null==k?void 0:k.white.name," vs ",null==k?void 0:k.black.name]})}),(0,i.jsxs)(u.A,{open:!v,fullWidth:!0,maxWidth:"sm",children:[(0,i.jsx)(m.A,{children:"Welcome to MrAnalyse"}),(0,i.jsxs)(g.A,{children:[(0,i.jsx)("p",{children:"To get started, please enter your Chess.com username below. This will allow MrAnalyse to automatically fetch and analyze your games as you play them."}),(0,i.jsx)(ta.A,{})]})]})]})}},79534:e=>{e.exports={style:{fontFamily:"'chessFont', 'chessFont Fallback'"},className:"__className_bd706f"}}},e=>{var t=t=>e(e.s=t);e.O(0,[774,969,927,696,358,986,302,585,546,636,593,792],()=>t(16760)),_N_E=e.O()}]);