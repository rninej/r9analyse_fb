"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[302],{658:(e,t,n)=>{n.d(t,{Yn:()=>a,ZH:()=>i,yy:()=>l});let a=e=>e<10?"0".concat(e):e,i=e=>e.charAt(0).toUpperCase()+e.slice(1),l=e=>new Promise(t=>setTimeout(t,e))},3816:(e,t,n)=>{n.d(t,{V:()=>i,e:()=>l});var a=n(658);let i=async(e,t)=>{var n,i;let l=new Date,r=l.getUTCFullYear(),s=l.getUTCMonth()+1,c=(0,a.Yn)(s),d=await fetch("https://api.chess.com/pub/player/".concat(e,"/games/").concat(r,"/").concat(c),{method:"GET",signal:t}),u=await d.json();if(d.status>=400&&"Date cannot be set in the future"!==u.message)throw Error("Error fetching games from Chess.com");let m=null!==(n=null==u?void 0:u.games)&&void 0!==n?n:[];if(m.length<50){let t=1===s?12:s-1,n=(0,a.Yn)(t),l=await fetch("https://api.chess.com/pub/player/".concat(e,"/games/").concat(12===t?r-1:r,"/").concat(n)),o=await l.json();m.push(...null!==(i=null==o?void 0:o.games)&&void 0!==i?i:[])}return m.filter(e=>e.pgn&&e.end_time).sort((e,t)=>t.end_time-e.end_time).slice(0,50).map(o)},l=async e=>{let t=encodeURIComponent(e.trim().toLowerCase()),n=await fetch("https://api.chess.com/pub/player/".concat(t)),a=await n.json(),i=null==a?void 0:a.avatar;return"string"==typeof i?i:null},o=e=>{var t,n,a,i,l,o,s,c,d;let u=null===(t=e.pgn.match(/\[Result "(.*?)"]/))||void 0===t?void 0:t[1],m=null===(n=e.pgn.match(/\d+?\. /g))||void 0===n?void 0:n.length;return{id:e.uuid||(null===(a=e.url)||void 0===a?void 0:a.split("/").pop())||e.id,pgn:e.pgn||"",white:{name:(null===(i=e.white)||void 0===i?void 0:i.username)||"White",rating:(null===(l=e.white)||void 0===l?void 0:l.rating)||0,title:null===(o=e.white)||void 0===o?void 0:o.title},black:{name:(null===(s=e.black)||void 0===s?void 0:s.username)||"Black",rating:(null===(c=e.black)||void 0===c?void 0:c.rating)||0,title:null===(d=e.black)||void 0===d?void 0:d.title},result:u,timeControl:r(e),date:e.end_time?new Date(1e3*e.end_time).toLocaleDateString():new Date().toLocaleDateString(),movesNb:m?2*m:void 0,url:e.url}},r=e=>{let t=e.time_control;if(!t)return;let[n,i]=t.split("+");if(!n)return;let l=Number(n),o=i?"+".concat(i):"";if(l<60)return"".concat(l,"s").concat(o);if(l<3600){let e=Math.floor(l/60),t=l%60;return t?"".concat(e,"m").concat((0,a.Yn)(t),"s").concat(o):"".concat(e,"m").concat(o)}let r=Math.floor(l/3600),s=Math.floor(l%3600/60);return s?"".concat(r,"h").concat((0,a.Yn)(s),"m").concat(o):"".concat(r,"h").concat(o)}},27064:(e,t,n)=>{n.d(t,{R:()=>u});var a=n(24307),i=n(99523),l=n(99542),o=n(85278),r=n(89099),s=n(14232);let c=(0,l.eU)([]),d=(0,l.eU)(!1),u=e=>{let[t,n]=(0,s.useState)(null),[l,u]=(0,o.fp)(c),[m,v]=(0,o.fp)(d),[h,f]=(0,s.useState)(void 0);(0,s.useEffect)(()=>{void 0!==e&&v(e)},[e,v]),(0,s.useEffect)(()=>{(async()=>{n(await (0,i.P2)("games",1,{upgrade(e){e.createObjectStore("games",{keyPath:"id",autoIncrement:!0})}}))})()},[]);let g=(0,s.useCallback)(async()=>{t&&m&&u(await t.getAll("games"))},[t,m,u]);(0,s.useEffect)(()=>{g()},[g]);let p=(0,s.useCallback)(async e=>{if(!t)throw Error("Database not initialized");let n=(0,a.mi)(e),i=await t.add("games",n);return g(),i},[t,g]),k=(0,s.useCallback)(async(e,n)=>{if(!t)throw Error("Database not initialized");let a=await t.get("games",e);if(!a)throw Error("Game not found");await t.put("games",{...a,eval:n}),g()},[t,g]),y=(0,s.useCallback)(async e=>{if(t)return t.get("games",e)},[t]),w=(0,s.useCallback)(async e=>{if(!t)throw Error("Database not initialized");await t.delete("games",e),g()},[t,g]),{gameId:b}=(0,r.useRouter)().query;return(0,s.useEffect)(()=>{"string"==typeof b?y(parseInt(b)).then(e=>{f(e)}):f(void 0)},[b,f,y]),{addGame:p,setGameEval:k,getGame:y,deleteGame:w,games:l,isReady:null!==t,gameFromUrl:h}}},34428:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(37876),i=n(9227),l=n(77018);function o(e){let{title:t,whiteValue:n,blackValue:o}=e;return(0,a.jsxs)(i.A,{justifyContent:"center",alignItems:"center",flexDirection:"row",columnGap:{xs:"8vw",md:10},children:[(0,a.jsx)(r,{value:n,color:"white"}),(0,a.jsx)(l.A,{align:"center",fontSize:"0.8em",noWrap:!0,children:t}),(0,a.jsx)(r,{value:o,color:"black"})]})}let r=e=>{let{value:t,color:n}=e;return(0,a.jsx)(l.A,{align:"center",sx:{backgroundColor:n,color:"white"===n?"black":"white"},borderRadius:"5px",lineHeight:"1em",fontSize:"0.9em",padding:.8,fontWeight:"500",border:"1px solid #424242",noWrap:!0,children:t})}},45175:(e,t,n)=>{n.d(t,{A:()=>f});var a=n(37876),i=n(19271),l=n(31084),o=n(77018),r=n(85278),s=n(52547),c=n(14232),d=n(54587),u=n.n(d),m=n(658),v=n(65897),h=n(92094);function f(e){let{classification:t}=e,n=(0,r.md)(s.Mx),d=(0,r.md)(s.Sd),f=(0,r.md)(s._X),{goToMove:g}=(0,v.j)(s.Sd),p=(0,c.useMemo)(()=>n?n.positions.filter((e,n)=>n%2!=0&&e.moveClassification===t).length:0,[n,t]),k=(0,c.useMemo)(()=>n?n.positions.filter((e,n)=>n%2==0&&e.moveClassification===t).length:0,[n,t]),y=e=>{if(!n||e===i.Q1.White&&!p||e===i.Q1.Black&&!k)return;let a=t=>t%2!=0&&e===i.Q1.White||t%2==0&&e===i.Q1.Black,l=d.history().length,o=n.positions.findIndex((e,n)=>a(n)&&e.moveClassification===t&&n>l);if(o>0)g(o,f);else{let e=n.positions.findIndex((e,n)=>a(n)&&e.moveClassification===t);e>0&&e!==l&&g(e,f)}};return(0,a.jsxs)(l.A,{container:!0,justifyContent:"space-evenly",alignItems:"center",wrap:"nowrap",color:h.k_[t],size:12,children:[(0,a.jsx)(l.A,{container:!0,justifyContent:"center",alignItems:"center",width:"3rem",style:{cursor:p?"pointer":"default"},onClick:()=>y(i.Q1.White),fontSize:"0.9rem",children:p}),(0,a.jsxs)(l.A,{container:!0,justifyContent:"start",alignItems:"center",width:"10rem",gap:1,wrap:"nowrap",children:[(0,a.jsx)(u(),{src:"/icons/".concat(t,".png"),alt:"move-icon",width:18,height:18,style:{maxWidth:"3.5vw",maxHeight:"3.5vw"}}),(0,a.jsx)(o.A,{align:"center",fontSize:"0.9rem",children:(0,m.ZH)(t)})]}),(0,a.jsx)(l.A,{container:!0,justifyContent:"center",alignItems:"center",width:"3rem",style:{cursor:k?"pointer":"default"},onClick:()=>y(i.Q1.Black),fontSize:"0.9rem",children:k})]})}},65897:(e,t,n)=>{n.d(t,{j:()=>g});var a=n(24307);let i=null,l=null,o=new Map,r={move:"/sounds/move.mp3",capture:"/sounds/capture.mp3",illegalMove:"/sounds/error.mp3"},s=async e=>{l&&clearTimeout(l),l=setTimeout(async()=>{i||(i=new AudioContext),"suspended"===i.state&&await i.resume();let t=o.get(r[e]);if(!t){let n=await fetch(r[e]),a=await i.decodeAudioData(await n.arrayBuffer());t=a,o.set(r[e],a)}let n=i.createBufferSource();n.buffer=t;let a=i.createGain();a.gain.value=.3,n.connect(a),a.connect(i.destination),n.start()},1)},c=()=>s("capture"),d=()=>s("illegalMove"),u=()=>s("move"),m=e=>e?e.captured?c():u():d();var v=n(22277),h=n(85278),f=n(14232);let g=e=>{let[t,n]=(0,h.fp)(e),i=(0,f.useCallback)(e=>{let t=new v.d$;t.loadPgn(e),n(t)},[n]),l=(0,f.useCallback)(e=>{let t=new v.d$(null==e?void 0:e.fen);(null==e?void 0:e.noHeaders)||(0,a.nt)(t,e),n(t)},[n]),o=(0,f.useCallback)(()=>{let e=new v.d$;if(0===t.history().length){var n,a;let i=t.pgn().split("]");if(["1-0","0-1","1/2-1/2","*"].includes(null!==(a=null===(n=i.at(-1))||void 0===n?void 0:n.trim())&&void 0!==a?a:""))return e.loadPgn(i.slice(0,-1).join("]")+"]"),e}return e.loadPgn(t.pgn()),e},[t]),r=(0,f.useCallback)(e=>{let t=e?(0,a.w0)(e):o();t.load(t.getHeaders().FEN||v.OS,{preserveHeaders:!0}),n(t)},[o,n]),s=(0,f.useCallback)(e=>{let t=o();try{let{comment:a,...i}=e,l=t.move(i);return a&&t.setComment(a),n(t),m(l),l}catch(e){return d(),null}},[o,n]),c=(0,f.useCallback)(e=>{let t=o(),a=null;for(let n of e)a=t.move(n);n(t),a&&m(a)},[o,n]);return{setPgn:i,reset:l,playMove:s,undoMove:(0,f.useCallback)(()=>{let e=o(),t=e.undo();t&&m(t),n(e)},[o,n]),goToMove:(0,f.useCallback)((e,t)=>{if(e<0)return;let a=new v.d$;a.loadPgn(t.pgn());let i=t.history().length;if(e>i)return;let l={};for(let t=i;t>e;t--)l=a.undo();n(a),m(l)},[n]),resetToStartingPosition:r,addMoves:c}}},82831:(e,t,n)=>{n.d(t,{K:()=>r});var a=n(85278),i=n(27064),l=n(41615),o=n(3816);let r=e=>{var t,n,l,o;let r=(0,a.md)(e),{gameFromUrl:c}=(0,i.R)(),d=r.getHeaders(),u=d.White&&"?"!==d.White?d.White:void 0,m=d.Black&&"?"!==d.Black?d.Black:void 0,v=(null==c?void 0:null===(t=c.white)||void 0===t?void 0:t.name)||u||"White",h=(null==c?void 0:null===(n=c.black)||void 0===n?void 0:n.name)||m||"Black",f=(null==c?void 0:null===(l=c.white)||void 0===l?void 0:l.rating)||Number(d.WhiteElo)||void 0,g=(null==c?void 0:null===(o=c.black)||void 0===o?void 0:o.rating)||Number(d.BlackElo)||void 0,p=((null==c?void 0:c.site)||d.Site||"unknown").toLowerCase().includes("chess.com"),k=s(v,p&&!!v&&"White"!==v),y=s(h,p&&!!h&&"Black"!==h);return{white:{name:v,rating:f,avatarUrl:null!=k?k:void 0},black:{name:h,rating:g,avatarUrl:null!=y?y:void 0}}},s=(e,t)=>{let{data:n}=(0,l.I)({queryKey:["CCAvatar",e],enabled:t,queryFn:()=>(0,o.e)(e),staleTime:36e5,gcTime:864e5});return n}},89243:(e,t,n)=>{n.d(t,{A:()=>x});var a=n(37876),i=n(14232),l=n(31084),o=n(11494),r=n(85278),s=n(80252),c=n(57377),d=n(22333),u=n(24354),m=n(1874),v=n(56321),h=n(75271),f=n(52547),g=n(24307);function p(e){let{active:t,payload:n}=e;if(!t||!(null==n?void 0:n.length))return null;let i=n[0].payload;return(0,a.jsx)("div",{style:{backgroundColor:"#f0f0f0",padding:5,color:"black",opacity:.9,border:"1px solid black",borderRadius:3},children:(0,g.l3)(i)})}var k=n(92094);function y(e){let{cx:t,cy:n,r:i,payload:l}=e,o=(null==l?void 0:l.moveClassification)?k.k_[l.moveClassification]:"grey";return(0,a.jsx)("circle",{cx:t,cy:n,r:i,stroke:o,strokeWidth:5,fill:o,fillOpacity:1})}var w=n(19271),b=n(65897);function x(e){var t;let n=(0,r.md)(f.Mx),g=(0,r.md)(f.eU),{goToMove:x}=(0,b.j)(f.Sd),j=(0,r.md)(f._X),A=(0,i.useMemo)(()=>{var e;return null!==(e=null==n?void 0:n.positions.map(C))&&void 0!==e?e:[]},[n]),M=(0,i.useMemo)(()=>{let e=A.filter(e=>e.moveClassification===w.eK.Best),t=Math.ceil(.15*e.length),n=e.map(e=>e.moveNb);for(let e=n.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[n[e],n[t]]=[n[t],n[e]]}return new Set(n.slice(0,t))},[A]),W=(null===(t=g.eval)||void 0===t?void 0:t.moveClassification)?k.k_[g.eval.moveClassification]:"grey",S=(0,i.useCallback)(e=>{let t=e.payload,n=null==t?void 0:t.moveClassification;return n&&([w.eK.Splendid,w.eK.Perfect,w.eK.Blunder,w.eK.Mistake].includes(n)||n===w.eK.Best&&M.has(t.moveNb))?(0,i.createElement)(y,{...e,key:e.key,payload:t}):(0,a.jsx)("svg",{},e.key)},[M]);return n?(0,a.jsx)(l.A,{container:!0,justifyContent:"center",alignItems:"center",minHeight:"min(10rem, 8vh)",height:{xs:"8rem",lg:"none"},maxHeight:"10rem",...e,sx:e.hidden?{display:"none"}:e.sx,size:12,children:(0,a.jsx)(o.A,{height:"100%",width:{xs:"100%",lg:"90%"},sx:{backgroundColor:"#2e2e2e",borderRadius:"15px",overflow:"hidden"},children:(0,a.jsx)(s.u,{width:"100%",height:"100%",children:(0,a.jsxs)(c.Q,{width:500,height:400,data:A,margin:{top:0,left:0,right:0,bottom:0},onClick:e=>{var t,n;let a=null==e?void 0:null===(n=e.activePayload)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.payload;a&&x(a.moveNb,j)},style:{cursor:"pointer"},children:[(0,a.jsx)(d.W,{dataKey:"moveNb",hide:!0,stroke:"red"}),(0,a.jsx)(u.h,{domain:[0,20],hide:!0}),(0,a.jsx)(m.m,{content:(0,a.jsx)(p,{}),isAnimationActive:!1,cursor:{stroke:"grey",strokeWidth:2,strokeOpacity:.3}}),(0,a.jsx)(v.G,{type:"monotone",dataKey:"value",stroke:"none",fill:"#ffffff",fillOpacity:1,dot:S,activeDot:(0,a.jsx)(y,{}),isAnimationActive:!1}),(0,a.jsx)(h.e,{y:10,stroke:"grey",strokeWidth:2,strokeOpacity:.4}),(0,a.jsx)(h.e,{x:g.currentMoveIdx,stroke:W,strokeWidth:4,strokeOpacity:.6})]})})})}):null}let C=(e,t)=>{let n=e.lines[0],a={moveNb:t,value:10,cp:n.cp,mate:n.mate,moveClassification:e.moveClassification};return n.mate?{...a,value:20*(n.mate>0)}:n.cp?{...a,value:Math.max(Math.min(n.cp/100,10),-10)+10}:a}},97121:(e,t,n)=>{n.d(t,{s:()=>o});var a=n(37876),i=n(77328),l=n.n(i);let o=e=>{let{title:t}=e;return(0,a.jsxs)(l(),{children:[(0,a.jsx)("title",{children:t}),(0,a.jsx)("meta",{property:"og:title",content:t})]})}}}]);