"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[302],{658:(e,t,a)=>{a.d(t,{Yn:()=>n,ZH:()=>i,yy:()=>l});let n=e=>e<10?"0".concat(e):e,i=e=>e.charAt(0).toUpperCase()+e.slice(1),l=e=>new Promise(t=>setTimeout(t,e))},3816:(e,t,a)=>{a.d(t,{V:()=>i,e:()=>l});var n=a(658);let i=async(e,t)=>{var a,i;let l=new Date,r=l.getUTCFullYear(),s=l.getUTCMonth()+1,c=(0,n.Yn)(s),d=await fetch("https://api.chess.com/pub/player/".concat(e,"/games/").concat(r,"/").concat(c),{method:"GET",signal:t}),u=await d.json();if(d.status>=400&&"Date cannot be set in the future"!==u.message)throw Error("Error fetching games from Chess.com");let m=null!==(a=null==u?void 0:u.games)&&void 0!==a?a:[];if(m.length<50){let t=1===s?12:s-1,a=(0,n.Yn)(t),l=await fetch("https://api.chess.com/pub/player/".concat(e,"/games/").concat(12===t?r-1:r,"/").concat(a)),o=await l.json();m.push(...null!==(i=null==o?void 0:o.games)&&void 0!==i?i:[])}return m.filter(e=>e.pgn&&e.end_time).sort((e,t)=>t.end_time-e.end_time).slice(0,50).map(o)},l=async e=>{let t=encodeURIComponent(e.trim().toLowerCase()),a=await fetch("https://api.chess.com/pub/player/".concat(t)),n=await a.json(),i=null==n?void 0:n.avatar;return"string"==typeof i?i:null},o=e=>{var t,a,n,i,l,o,s,c,d;let u=null===(t=e.pgn.match(/\[Result "(.*?)"]/))||void 0===t?void 0:t[1],m=null===(a=e.pgn.match(/\d+?\. /g))||void 0===a?void 0:a.length;return{id:e.uuid||(null===(n=e.url)||void 0===n?void 0:n.split("/").pop())||e.id,pgn:e.pgn||"",white:{name:(null===(i=e.white)||void 0===i?void 0:i.username)||"White",rating:(null===(l=e.white)||void 0===l?void 0:l.rating)||0,title:null===(o=e.white)||void 0===o?void 0:o.title},black:{name:(null===(s=e.black)||void 0===s?void 0:s.username)||"Black",rating:(null===(c=e.black)||void 0===c?void 0:c.rating)||0,title:null===(d=e.black)||void 0===d?void 0:d.title},result:u,timeControl:r(e),date:e.end_time?new Date(1e3*e.end_time).toLocaleDateString():new Date().toLocaleDateString(),movesNb:m?2*m:void 0,url:e.url}},r=e=>{let t=e.time_control;if(!t)return;let[a,i]=t.split("+");if(!a)return;let l=Number(a),o=i?"+".concat(i):"";if(l<60)return"".concat(l,"s").concat(o);if(l<3600){let e=Math.floor(l/60),t=l%60;return t?"".concat(e,"m").concat((0,n.Yn)(t),"s").concat(o):"".concat(e,"m").concat(o)}let r=Math.floor(l/3600),s=Math.floor(l%3600/60);return s?"".concat(r,"h").concat((0,n.Yn)(s),"m").concat(o):"".concat(r,"h").concat(o)}},27064:(e,t,a)=>{a.d(t,{R:()=>u});var n=a(24307),i=a(99523),l=a(99542),o=a(85278),r=a(89099),s=a(14232);let c=(0,l.eU)([]),d=(0,l.eU)(!1),u=e=>{let[t,a]=(0,s.useState)(null),[l,u]=(0,o.fp)(c),[m,v]=(0,o.fp)(d),[f,h]=(0,s.useState)(void 0);(0,s.useEffect)(()=>{void 0!==e&&v(e)},[e,v]),(0,s.useEffect)(()=>{(async()=>{a(await (0,i.P2)("games",1,{upgrade(e){e.createObjectStore("games",{keyPath:"id",autoIncrement:!0})}}))})()},[]);let p=(0,s.useCallback)(async()=>{t&&m&&u(await t.getAll("games"))},[t,m,u]);(0,s.useEffect)(()=>{p()},[p]);let g=(0,s.useCallback)(async e=>{if(!t)throw Error("Database not initialized");let a=(0,n.mi)(e),i=await t.add("games",a);return p(),i},[t,p]),x=(0,s.useCallback)(async(e,a)=>{if(!t)throw Error("Database not initialized");let n=await t.get("games",e);if(!n)throw Error("Game not found");await t.put("games",{...n,eval:a}),p()},[t,p]),k=(0,s.useCallback)(async e=>{if(t)return t.get("games",e)},[t]),b=(0,s.useCallback)(async e=>{if(!t)throw Error("Database not initialized");await t.delete("games",e),p()},[t,p]),{gameId:y}=(0,r.useRouter)().query;return(0,s.useEffect)(()=>{"string"==typeof y?k(parseInt(y)).then(e=>{h(e)}):h(void 0)},[y,h,k]),{addGame:g,setGameEval:x,getGame:k,deleteGame:b,games:l,isReady:null!==t,gameFromUrl:f}}},34428:(e,t,a)=>{a.d(t,{A:()=>r});var n=a(37876),i=a(9227),l=a(77018),o=a(11494);function r(e){let{title:t,whiteValue:a,blackValue:o}=e;return(0,n.jsxs)(i.A,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{my:2,px:2,py:1,backgroundColor:"#3a3a3a",borderRadius:"8px"},children:[(0,n.jsx)(s,{value:a}),(0,n.jsx)(l.A,{sx:{fontWeight:500,fontSize:"1rem",color:"#ffffff"},children:t}),(0,n.jsx)(s,{value:o})]})}let s=e=>{let{value:t}=e;return(0,n.jsx)(o.A,{sx:{p:1.5,borderRadius:"6px",backgroundColor:"#4a4a4a",minWidth:"80px",textAlign:"center"},children:(0,n.jsx)(l.A,{sx:{fontWeight:"bold",fontSize:"1.1rem",color:"#ffffff"},children:t})})}},45175:(e,t,a)=>{a.d(t,{A:()=>p});var n=a(37876),i=a(19271),l=a(11951),o=a(31084),r=a(77018),s=a(85278),c=a(52547),d=a(14232),u=a(54587),m=a.n(u),v=a(658),f=a(65897),h=a(92094);function p(e){let{classification:t}=e,a=(0,s.md)(c.Mx),u=(0,s.md)(c.Sd),p=(0,s.md)(c._X),{goToMove:g}=(0,f.j)(c.Sd),x=(0,d.useMemo)(()=>a?a.positions.filter((e,a)=>a%2!=0&&e.moveClassification===t).length:0,[a,t]),k=(0,d.useMemo)(()=>a?a.positions.filter((e,a)=>a%2==0&&e.moveClassification===t).length:0,[a,t]),b=e=>{if(!a||e===i.Q1.White&&!x||e===i.Q1.Black&&!k)return;let n=t=>t%2!=0&&e===i.Q1.White||t%2==0&&e===i.Q1.Black,l=u.history().length,o=a.positions.findIndex((e,a)=>n(a)&&e.moveClassification===t&&a>l);if(o>0)g(o,p);else{let e=a.positions.findIndex((e,a)=>n(a)&&e.moveClassification===t);e>0&&e!==l&&g(e,p)}};return(0,n.jsx)(l.A,{elevation:2,sx:{my:.5,p:1,backgroundColor:"#3a3a3a",borderRadius:"8px","&:hover":{backgroundColor:"#4a4a4a"}},children:(0,n.jsxs)(o.A,{container:!0,justifyContent:"space-between",alignItems:"center",wrap:"nowrap",color:h.k_[t],size:12,children:[(0,n.jsx)(o.A,{container:!0,justifyContent:"center",alignItems:"center",sx:{cursor:x?"pointer":"default",width:"4rem",p:1,borderRadius:"6px","&:hover":{bgcolor:x?"#5a5a5a":"transparent"}},onClick:()=>b(i.Q1.White),children:(0,n.jsx)(r.A,{sx:{fontWeight:"bold",fontSize:"1rem"},children:x})}),(0,n.jsxs)(o.A,{container:!0,justifyContent:"start",alignItems:"center",gap:1.5,wrap:"nowrap",sx:{flexGrow:1,mx:1},children:[(0,n.jsx)(m(),{src:"/icons/".concat(t,".png"),alt:"move-icon",width:24,height:24}),(0,n.jsx)(r.A,{sx:{fontWeight:500,fontSize:"1.1rem",color:"#ffffff"},children:(0,v.ZH)(t)})]}),(0,n.jsx)(o.A,{container:!0,justifyContent:"center",alignItems:"center",sx:{cursor:k?"pointer":"default",width:"4rem",p:1,borderRadius:"6px","&:hover":{bgcolor:k?"#5a5a5a":"transparent"}},onClick:()=>b(i.Q1.Black),children:(0,n.jsx)(r.A,{sx:{fontWeight:"bold",fontSize:"1rem"},children:k})})]})})}},65897:(e,t,a)=>{a.d(t,{j:()=>p});var n=a(24307);let i=null,l=null,o=new Map,r={move:"/sounds/move.mp3",capture:"/sounds/capture.mp3",illegalMove:"/sounds/error.mp3"},s=async e=>{l&&clearTimeout(l),l=setTimeout(async()=>{i||(i=new AudioContext),"suspended"===i.state&&await i.resume();let t=o.get(r[e]);if(!t){let a=await fetch(r[e]),n=await i.decodeAudioData(await a.arrayBuffer());t=n,o.set(r[e],n)}let a=i.createBufferSource();a.buffer=t;let n=i.createGain();n.gain.value=.3,a.connect(n),n.connect(i.destination),a.start()},1)},c=()=>s("capture"),d=()=>s("illegalMove"),u=()=>s("move"),m=e=>e?e.captured?c():u():d();var v=a(22277),f=a(85278),h=a(14232);let p=e=>{let[t,a]=(0,f.fp)(e),i=(0,h.useCallback)(e=>{let t=new v.d$;t.loadPgn(e),a(t)},[a]),l=(0,h.useCallback)(e=>{let t=new v.d$(null==e?void 0:e.fen);(null==e?void 0:e.noHeaders)||(0,n.nt)(t,e),a(t)},[a]),o=(0,h.useCallback)(()=>{let e=new v.d$;if(0===t.history().length){var a,n;let i=t.pgn().split("]");if(["1-0","0-1","1/2-1/2","*"].includes(null!==(n=null===(a=i.at(-1))||void 0===a?void 0:a.trim())&&void 0!==n?n:""))return e.loadPgn(i.slice(0,-1).join("]")+"]"),e}return e.loadPgn(t.pgn()),e},[t]),r=(0,h.useCallback)(e=>{let t=e?(0,n.w0)(e):o();t.load(t.getHeaders().FEN||v.OS,{preserveHeaders:!0}),a(t)},[o,a]),s=(0,h.useCallback)(e=>{let t=o();try{let{comment:n,...i}=e,l=t.move(i);return n&&t.setComment(n),a(t),m(l),l}catch(e){return d(),null}},[o,a]),c=(0,h.useCallback)(e=>{let t=o(),n=null;for(let a of e)n=t.move(a);a(t),n&&m(n)},[o,a]);return{setPgn:i,reset:l,playMove:s,undoMove:(0,h.useCallback)(()=>{let e=o(),t=e.undo();t&&m(t),a(e)},[o,a]),goToMove:(0,h.useCallback)((e,t)=>{if(e<0)return;let n=new v.d$;n.loadPgn(t.pgn());let i=t.history().length;if(e>i)return;let l={};for(let t=i;t>e;t--)l=n.undo();a(n),m(l)},[a]),resetToStartingPosition:r,addMoves:c}}},82831:(e,t,a)=>{a.d(t,{K:()=>r});var n=a(85278),i=a(27064),l=a(41615),o=a(3816);let r=e=>{var t,a,l,o;let r=(0,n.md)(e),{gameFromUrl:c}=(0,i.R)(),d=r.getHeaders(),u=d.White&&"?"!==d.White?d.White:void 0,m=d.Black&&"?"!==d.Black?d.Black:void 0,v=(null==c?void 0:null===(t=c.white)||void 0===t?void 0:t.name)||u||"White",f=(null==c?void 0:null===(a=c.black)||void 0===a?void 0:a.name)||m||"Black",h=(null==c?void 0:null===(l=c.white)||void 0===l?void 0:l.rating)||Number(d.WhiteElo)||void 0,p=(null==c?void 0:null===(o=c.black)||void 0===o?void 0:o.rating)||Number(d.BlackElo)||void 0,g=((null==c?void 0:c.site)||d.Site||"unknown").toLowerCase().includes("chess.com"),x=s(v,g&&!!v&&"White"!==v),k=s(f,g&&!!f&&"Black"!==f);return{white:{name:v,rating:h,avatarUrl:null!=x?x:void 0},black:{name:f,rating:p,avatarUrl:null!=k?k:void 0}}},s=(e,t)=>{let{data:a}=(0,l.I)({queryKey:["CCAvatar",e],enabled:t,queryFn:()=>(0,o.e)(e),staleTime:36e5,gcTime:864e5});return a}},89243:(e,t,a)=>{a.d(t,{A:()=>w});var n=a(37876),i=a(14232),l=a(31084),o=a(11494),r=a(85278),s=a(80252),c=a(57377),d=a(22333),u=a(24354),m=a(1874),v=a(56321),f=a(75271),h=a(52547),p=a(24307);function g(e){let{active:t,payload:a}=e;if(!t||!(null==a?void 0:a.length))return null;let i=a[0].payload;return(0,n.jsx)("div",{style:{backgroundColor:"#f0f0f0",padding:5,color:"black",opacity:.9,border:"1px solid black",borderRadius:3},children:(0,p.l3)(i)})}var x=a(92094);function k(e){let{cx:t,cy:a,r:i,payload:l}=e,o=(null==l?void 0:l.moveClassification)?x.k_[l.moveClassification]:"grey";return(0,n.jsx)("circle",{cx:t,cy:a,r:i,stroke:o,strokeWidth:5,fill:o,fillOpacity:1})}var b=a(19271),y=a(65897);function w(e){var t;let a=(0,r.md)(h.Mx),p=(0,r.md)(h.eU),{goToMove:w}=(0,y.j)(h.Sd),j=(0,r.md)(h._X),A=(0,i.useMemo)(()=>{var e;return null!==(e=null==a?void 0:a.positions.map(C))&&void 0!==e?e:[]},[a]),M=(0,i.useMemo)(()=>{let e=A.filter(e=>e.moveClassification===b.eK.Best),t=Math.ceil(.15*e.length),a=e.map(e=>e.moveNb);for(let e=a.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[a[e],a[t]]=[a[t],a[e]]}return new Set(a.slice(0,t))},[A]),W=(null===(t=p.eval)||void 0===t?void 0:t.moveClassification)?x.k_[p.eval.moveClassification]:"grey",S=(0,i.useCallback)(e=>{let t=e.payload,a=null==t?void 0:t.moveClassification;return a&&([b.eK.Splendid,b.eK.Perfect,b.eK.Blunder,b.eK.Mistake].includes(a)||a===b.eK.Best&&M.has(t.moveNb))?(0,i.createElement)(k,{...e,key:e.key,payload:t}):(0,n.jsx)("svg",{},e.key)},[M]);return a?(0,n.jsx)(l.A,{container:!0,justifyContent:"center",alignItems:"center",minHeight:"min(10rem, 8vh)",height:{xs:"8rem",lg:"none"},maxHeight:"10rem",...e,sx:e.hidden?{display:"none"}:e.sx,size:12,children:(0,n.jsx)(o.A,{height:"100%",width:{xs:"100%",lg:"90%"},sx:{backgroundColor:"#2e2e2e",borderRadius:"15px",overflow:"hidden"},children:(0,n.jsx)(s.u,{width:"100%",height:"100%",children:(0,n.jsxs)(c.Q,{width:500,height:400,data:A,margin:{top:0,left:0,right:0,bottom:0},onClick:e=>{var t,a;let n=null==e?void 0:null===(a=e.activePayload)||void 0===a?void 0:null===(t=a[0])||void 0===t?void 0:t.payload;n&&w(n.moveNb,j)},style:{cursor:"pointer"},children:[(0,n.jsx)(d.W,{dataKey:"moveNb",hide:!0,stroke:"red"}),(0,n.jsx)(u.h,{domain:[0,20],hide:!0}),(0,n.jsx)(m.m,{content:(0,n.jsx)(g,{}),isAnimationActive:!1,cursor:{stroke:"grey",strokeWidth:2,strokeOpacity:.3}}),(0,n.jsx)(v.G,{type:"monotone",dataKey:"value",stroke:"none",fill:"#ffffff",fillOpacity:1,dot:S,activeDot:(0,n.jsx)(k,{}),isAnimationActive:!1}),(0,n.jsx)(f.e,{y:10,stroke:"grey",strokeWidth:2,strokeOpacity:.4}),(0,n.jsx)(f.e,{x:p.currentMoveIdx,stroke:W,strokeWidth:4,strokeOpacity:.6})]})})})}):null}let C=(e,t)=>{let a=e.lines[0],n={moveNb:t,value:10,cp:a.cp,mate:a.mate,moveClassification:e.moveClassification};return a.mate?{...n,value:20*(a.mate>0)}:a.cp?{...n,value:Math.max(Math.min(a.cp/100,10),-10)+10}:n}},97121:(e,t,a)=>{a.d(t,{s:()=>o});var n=a(37876),i=a(77328),l=a.n(i);let o=e=>{let{title:t}=e;return(0,n.jsxs)(l(),{children:[(0,n.jsx)("title",{children:t}),(0,n.jsx)("meta",{property:"og:title",content:t})]})}}}]);